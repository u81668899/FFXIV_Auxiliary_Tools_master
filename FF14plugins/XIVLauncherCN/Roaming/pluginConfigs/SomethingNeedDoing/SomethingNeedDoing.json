{
  "Version": 1,
  "LockWindow": false,
  "DefaultFileName": "UntitledMacro",
  "DefaultFileExtension": ".txt",
  "Files": [],
  "RootFolder": {
    "Name": "/",
    "Children": [
      {
        "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
        "Name": "练级",
        "Children": [
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "80-82",
            "Gist": "",
            "Contents": "/ac 闲静 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 长期俭约 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 崇敬 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料制作 <wait.2.5>",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "83-89",
            "Gist": "",
            "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"俭约\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"模范制作\" <wait.2.5>",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "练级560",
            "Gist": "",
            "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"模范制作\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "召唤一键宏",
            "Gist": "",
            "Contents": "/ac 以太蓄能\n/ac 以太蓄能\n/ac 以太蓄能\n/ac 星极超流\n/ac 宝石耀\n/ac 宝石耀\n/ac 风神召唤\n/ac 土神召唤\n/ac 火神召唤\n/ac 毁灭\n/ac 能量吸收\n/ac 龙神迸发\n/ac 溃烂爆发\n/ac 醒梦\n/loop <wait.0.13>",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "召唤一键宏aoe",
            "Gist": "",
            "Contents": "/ac 以太蓄能\n/ac 以太蓄能\n/ac 以太蓄能\n/ac 星极超流\n/ac 宝石辉\n/ac 宝石辉\n/ac 风神召唤\n/ac 土神召唤\n/ac 火神召唤\n/ac 迸裂\n/ac 能量抽取\n/ac 龙神迸发\n/ac 痛苦核爆\n/ac 醒梦\n/loop <wait.0.13>",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "黑魔一键循环",
            "Gist": "",
            "Contents": "/ac 冰封 <wait.2.45>\n/ac 火炎 <wait.1.00>\n/ac 激情咏唱 <wait.1.45>\n/ac 冰澈 <wait.2.55>\n/ac 暴雷 <wait.2.45>\n/ac 爆炎 <wait.2.45>\n/ac 炽炎 <wait.2.85>\n/ac 炽炎 <wait.2.85>\n/ac 炽炎 <wait.2.85>\n/ac 炽炎 <wait.2.85>\n/ac 火炎 <wait.2.55>\n/ac 炽炎 <wait.2.85>\n/ac 炽炎 <wait.2.85>\n/ac 异言 <wait.2.55>\n/ac 绝望 <wait.3.03>\n/statusoff 火苗\n/loop",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "战士一键宏aoe",
            "Gist": "",
            "Contents": "/ac 地毁人亡\n/ac 超压斧\n/ac 秘银暴风 <wait.1.35>\n/ac 战嚎\n/ac 原初的解放\n/ac 原初的直觉 <wait.1.00>\n/loop",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          }
        ]
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "P8S减伤",
        "Gist": "",
        "Contents": "/p ----------MT血仇---------- <se.5>\n/p 0:07 开场永恒之火\n/p 1:19 冰/火第二次+一运前永恒之火\n/p 2:46 一运后永恒之火\n/p 4:21 分摊分散\n/p 5:23 二运概念支配\n/p 6:57 软狂暴第一次永恒之苦\n/p 8:00 软狂暴第三次永恒之苦\n/p ----------ST血仇----------\n/p 0:55 分摊分散\n/p 1:55 一运概念支配\n/p 3:28 万象后永恒之火\n/p 4:56 二运前永恒之火\n/p 7:26 软狂暴第二次永恒之苦\n/p ----------MT90s减伤/D4昏乱---------- <se.5>\n/p 0:07 开场永恒之火\n/p 1:50 一运概念支配\n/p 3:28 万象后永恒之火\n/p 5:23 二运概念支配\n/p 6:57 软狂暴第三/一次永恒之苦\n/p (能压掉就放第一次)\n/p ----------ST90s减伤----------\n/p 1:14 冰/火+一运前永恒之火\n/p 2:46 一运后永恒之火\n/p 4:40 第二次冰火\n/p 7:26 软狂暴第二次永恒之苦\n/p ----------远敏减伤---------- <se.5>\n/p 1:14 冰/火+一运前永恒之火\n/p 2:46 一运后永恒之火\n/p 4:56 二运前永恒之火\n/p 7:32 软狂暴第二次永恒之苦\n/p 第二次支配者的一击\n/p ----------D1牵制---------- <se.5>\n/p 0:07 开场永恒之火\n/p 1:50 一运概念支配\n/p 3:28 万象后永恒之火\n/p 5:23 二运概念支配\n/p 7:08 第一次支配者的一击\n/p ----------D2牵制/病毒----------\n/p 1:19 冰/火第二次+一运前永恒之火\n/p 2:50 一运后永恒之火\n/p 4:40 第二次冰火\n/p 7:37 第二次支配者的一击",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 0
      },
      {
        "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
        "Name": "青魔",
        "Children": [
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "水力",
            "Gist": "",
            "Contents": "/青魔法技能 水力吸引 <wait.2.5>\n/loop",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          },
          {
            "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
            "Name": "陆行鸟",
            "Gist": "",
            "Contents": "/青魔法技能 陆行鸟陨石 <wait.2.5>\n/loop",
            "CraftingLoop": false,
            "IsPostProcess": false,
            "CraftLoopCount": 0,
            "Language": 0
          }
        ]
      },
      {
        "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
        "Name": "制作",
        "Children": [
          {
            "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
            "Name": "3664 3784",
            "Children": [
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 610半成品 622",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精修\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 610成品 655",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"上级加工\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"模范制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 610成品 538",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 83幻水宏",
                "Gist": "",
                "Contents": "/ac \"掌握\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 620半成品 628",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"观察\" <wait.2.5>\n/ac \"注视制作\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 620成品 618",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"观察\" <wait.2.5>\n/ac \"注视加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"观察\" <wait.2.5>\n/ac \"注视制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3664 3784 620成品 668",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"观察\" <wait.2.5>\n/ac \"注视加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"工匠的神技\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"观察\" <wait.2.5>\n/ac \"注视制作\" <wait.2.5>\n\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "3981 3825 620成品 657",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"最终确认\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"改革\" <wait.1.5>\n/ac \"观察\" <wait.2.5>\n/ac \"注视加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"工匠的神技\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"制作\" <wait.2.5>\n\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "巨匠药酒",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.7>\n/ac 长期俭约 <wait.1.7>\n/ac 坯料制作 <wait.2.7>\n/ac 坯料加工 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 坯料加工 <wait.2.7>\n/ac 坯料加工 <wait.2.7>\n/ac 坯料加工 <wait.2.7>\n/ac 比尔格的祝福 <wait.2.7>\n/ac 坯料制作 <wait.2.7>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "坚信憧憬制作制作",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 长期俭约 <wait.1.5>\n/ac 崇敬 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料制作 <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "临时制作",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.7>\n/ac 坯料制作",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "名匠药酒",
                "Gist": "",
                "Contents": "/ac 闲静 <wait.2.7>\n/ac 长期俭约 <wait.1.7>\n/ac 改革 <wait.1.7>\n/ac 坯料加工 <wait.2.7>\n/ac 坯料加工 <wait.2.7>\n/ac 坯料加工 <wait.2.7>\n/ac 精密制作 <wait.2.7>\n/ac 比尔格的祝福 <wait.2.7>\n/ac 崇敬 <wait.1.7>\n/ac 坯料制作 <wait.2.7>\n/ac 坯料制作 <wait.2.7>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 999,
                "Language": 0
              }
            ]
          },
          {
            "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
            "Name": "590",
            "Children": [
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 590 成品",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 崇敬 <wait.1.5>\n/ac 掌握 <wait.1.5>\n/ac 长期俭约 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 加工 <wait.2.5>\n/ac 中级加工 <wait.2.5>\n/ac 上级加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 加工 <wait.2.5>\n/ac 中级加工 <wait.2.5>\n/ac 上级加工 <wait.2.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 模范制作 <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 580 半成品",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"上级加工\" <wait.2.5>\n/ac \"精修\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "88 半成品",
                "Gist": "",
                "Contents": "/ac \"掌握\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 580 成品",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 崇敬 <wait.1.5>\n/ac 长期俭约 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 模范制作 <wait.2.5>\n/ac 精密制作 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 俭约加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 制作 <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90收藏品",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 长期俭约 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 精密制作 <wait.2.5>\n/ac 精密制作 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 模范制作 <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "辉煌12",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.7>\n/ac 专心致志 <wait.2.7>\n/ac 掌握 <wait.1.7>\n/ac 崇敬 <wait.1.7>\n/ac 集中制作 <wait.2.7>\n/ac 最终确认 <wait.1.7>\n/ac 俭约制作 <wait.2.7>\n/ac 最终确认 <wait.1.7>\n/ac 模范制作 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 掌握 <wait.1.7>\n/ac 改革 <wait.1.7>\n/ac 俭约加工 <wait.2.7>\n/ac 加工 <wait.2.7>\n/ac 中级加工 <wait.2.7>\n/ac 上级加工 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 加工 <wait.2.7>\n/ac 中级加工 <wait.2.7>\n/ac 上级加工 <wait.2.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 阔步 <wait.1.7>\n/ac 比尔格的祝福 <wait.2.7>\n/ac 制作 <wait.2.7>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "辉煌3",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.7>\n/ac 掌握 <wait.1.7>\n/ac 专心致志 <wait.2.7>\n/ac 崇敬 <wait.1.7>\n/ac 集中制作 <wait.2.7>\n/ac 最终确认 <wait.1.7>\n/ac 俭约制作 <wait.2.7>\n/ac 最终确认 <wait.1.7>\n/ac 俭约制作 <wait.2.7>\n/ac 最终确认 <wait.1.7>\n/ac 制作 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 俭约加工 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 掌握 <wait.1.7>\n/ac 改革 <wait.1.7>\n/ac 俭约加工 <wait.2.7>\n/ac 加工 <wait.2.7>\n/ac 中级加工 <wait.2.7>\n/ac 上级加工 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 加工 <wait.2.7>\n/ac 中级加工 <wait.2.7>\n/ac 上级加工 <wait.2.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 阔步 <wait.1.7>\n/ac 比尔格的祝福 <wait.2.7>\n/ac 制作 <wait.2.7>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              }
            ]
          },
          {
            "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
            "Name": "3232 3307",
            "Children": [
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 2X 半成品",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.7>\n/ac 崇敬 <wait.1.7>\n/ac 坯料制作 <wait.2.7>\n/ac 模范制作",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 2X 580HQ 3180 3311 665",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.7>\n/ac 俭约加工 <wait.2.7>\n/ac 掌握 <wait.1.7>\n/ac 崇敬 <wait.1.7>\n/ac 长期俭约 <wait.1.7>\n/ac 坯料制作 <wait.2.7>\n/ac 坯料制作 <wait.2.7>\n/ac 精密制作 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 坯料加工 <wait.2.7>\n/ac 加工 <wait.2.7>\n/ac 中级加工 <wait.2.7>\n/ac 上级加工 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 加工 <wait.2.7>\n/ac 中级加工 <wait.2.7>\n/ac 上级加工 <wait.2.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 改革 <wait.1.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 工匠的神技 <wait.2.7>\n/ac 阔步 <wait.1.7>\n/ac 比尔格的祝福 <wait.2.7>\n/ac 制作",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 590 半成品 开荒",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.7>\n/ac \"掌握\" <wait.1.7>\n/ac \"崇敬\" <wait.1.7>\n/ac \"坯料制作\" <wait.2.7>\n/ac \"精密制作\" <wait.2.7>\n/ac \"改革\" <wait.1.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"掌握\" <wait.1.7>\n/ac \"改革\" <wait.1.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"俭约加工\" <wait.2.7>\n/ac \"改革\" <wait.1.7>\n/ac \"坯料加工\" <wait.2.7>\n/ac \"阔步\" <wait.1.7>\n/ac \"比尔格的祝福\" <wait.2.7>\n/ac \"模范制作\" <wait.2.7>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "90 590 成品 开荒",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.7>\n/ac \"掌握\" <wait.1.7>\n/ac \"崇敬\" <wait.1.7>\n/ac \"长期俭约\" <wait.1.7>\n/ac \"坯料制作\" <wait.2.7>\n/ac \"坯料制作\" <wait.2.7>\n/ac \"改革\" <wait.1.7>\n/ac \"坯料加工\" <wait.2.7>\n/ac \"坯料加工\" <wait.2.7>\n/ac \"坯料加工\" <wait.2.7>\n/ac \"坯料加工\" <wait.2.7>\n/ac \"阔步\" <wait.1.7>\n/ac \"改革\" <wait.1.7>\n/ac \"坯料加工\" <wait.2.7>\n/ac \"工匠的神技\" <wait.2.7>\n/ac \"阔步\" <wait.1.7>\n/ac \"比尔格的祝福\" <wait.2.7>\n/ac \"模范制作\" <wait.2.7>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              }
            ]
          },
          {
            "$type": "SomethingNeedDoing.FolderNode, SomethingNeedDoing",
            "Name": "4237 3831 596",
            "Children": [
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 620成品 702",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 崇敬 <wait.1.5>\n/ac 俭约 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料制作 <wait.2.5>\n/ac 模范制作 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 俭约加工 <wait.2.5>\n/ac 加工 <wait.2.5>\n/ac 中级加工 <wait.2.5>\n/ac 上级加工 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 俭约加工 <wait.2.5>\n/ac 加工 <wait.2.5>\n/ac 中级加工 <wait.2.5>\n/ac 上级加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 模范制作 <wait.2.5>\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 620半成品 636",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精修\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"上级加工\" <wait.2.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 610成品 672",
                "Gist": "",
                "Contents": "/ac \"坚信\" <wait.2.5>\n/ac \"掌握\" <wait.1.5>\n/ac \"俭约加工\" <wait.2.5>\n/ac \"崇敬\" <wait.1.5>\n/ac \"长期俭约\" <wait.1.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"坯料制作\" <wait.2.5>\n/ac \"精密制作\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"坯料加工\" <wait.2.5>\n/ac \"加工\" <wait.2.5>\n/ac \"中级加工\" <wait.2.5>\n/ac \"上级加工\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"加工\" <wait.2.5>\n/ac \"中级加工\" <wait.2.5>\n/ac \"上级加工\" <wait.2.5>\n/ac \"工匠的神技\" <wait.2.5>\n/ac \"改革\" <wait.1.5>\n/ac \"工匠的神技\" <wait.2.5>\n/ac \"工匠的神技\" <wait.2.5>\n/ac \"阔步\" <wait.1.5>\n/ac \"比尔格的祝福\" <wait.2.5>\n/ac \"模范制作\" <wait.2.5>\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 88成品",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 长期俭约 <wait.1.5>\n/ac 模范制作 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 坯料制作 <wait.2.5>\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 专家 翼龙 高山茶 680",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 崇敬 <wait.1.5>\n/ac 掌握 <wait.1.5>\n/ac 长期俭约 <wait.1.5>\n/ac 专心致志 <wait.2.5>\n/ac 集中制作 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 工匠的神技 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 坯料制作 <wait.2.5>\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "临时搓",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 崇敬 <wait.1.5>\n/ac 俭约 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料制作 <wait.2.5>\n/ac 模范制作 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 加工 <wait.2.5>\n/ac 中级加工 <wait.2.5>\n/ac 上级加工 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 加工 <wait.2.5>\n/ac 中级加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 阔步 <wait.1.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 制作 <wait.2.5>\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 89成品",
                "Gist": "",
                "Contents": "/ac 闲静 <wait.2.5>\n/ac 长期俭约 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 崇敬 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料制作 <wait.2.5>\n",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 90成品",
                "Gist": "",
                "Contents": "/ac 坚信 <wait.2.5>\n/ac 长期俭约 <wait.1.5>\n/ac 坯料制作 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 模范制作 <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              },
              {
                "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
                "Name": "4237 3831 83半成品",
                "Gist": "",
                "Contents": "/ac 精密制作 <wait.2.5>\n/ac 掌握 <wait.1.5>\n/ac 长期俭约 <wait.1.5>\n/ac 改革 <wait.1.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 坯料加工 <wait.2.5>\n/ac 比尔格的祝福 <wait.2.5>\n/ac 坯料制作 <wait.2.5>",
                "CraftingLoop": false,
                "IsPostProcess": false,
                "CraftLoopCount": 0,
                "Language": 0
              }
            ]
          }
        ]
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "lifu",
        "Gist": "",
        "Contents": "/target 格里格 <wait.0.2>\n/send NUMPAD0\n/waitaddon GuildLeve <wait.0.2>\n#/click guild_leve_alchemist <wait.0.2>\n/click journal_detail_accept <wait.0.3>\n/send ESCAPE <wait.0.3>\n/send ESCAPE <wait.0.7>\n/target 阿尔德伊恩 <wait.0.2>\n/send NUMPAD0 <wait.2>\n/loop 99",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 0
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "停止时下坐骑",
        "Gist": "",
        "Contents": " muuv = 1\n muuvX = GetPlayerRawXPos()\n muuvY = GetPlayerRawYPos()\n muuvZ = GetPlayerRawZPos()\n while muuv == 1 do\n    yield(\"/wait 1\")\n    if muuvX == GetPlayerRawXPos() and muuvY == GetPlayerRawYPos() and muuvZ == GetPlayerRawZPos() then\n        muuv = 0\n        yield(\"/ac 挑衅\")\n    end\n    muuvX = GetPlayerRawXPos()\n    muuvY = GetPlayerRawYPos()\n    muuvZ = GetPlayerRawZPos()\n end",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 2
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "不在传送就fly",
        "Gist": "",
        "Contents": "isCasting = IsPlayerCasting()\n    if isCasting == false then\n        yield(\"/vnav stop\")\n        yield(\"/vnav flyflag\")\n    end",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 2
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "脱战上坐骑",
        "Gist": "",
        "Contents": "while GetCharacterCondition(4, false) do\n   if GetCharacterCondition(26, false) then\n      yield(\"/共通技能 随机坐骑\")\n      yield(\"/wait 2\")\n    else\n      yield(\"/wait 0.5\")\n    end\nend",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 2
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "点击确认",
        "Gist": "",
        "Contents": "/waitaddon SelectYesno\n/wait 0.2\n/click SelectYesno Yes",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 0
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "清末触发",
        "Gist": "",
        "Contents": "/青魔法技能 狂风暴雪 <wait.10>\n/loop",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 0
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "钓鱼",
        "Gist": "",
        "Contents": "----------基于SND官库双采收藏品脚本LegendaryFarmer-1.0.4修改----------\n----------https://github.com/Jaksuhn/SomethingNeedDoing/blob/a9514320a836f6800682066721c8ecc1d8c46d12/Community%20Scripts/Gathering/LegendaryFarmer-1.0.4.lua----------\n\n\n----------以下部分可以自行设置 默认为钓橙票秃鹰----------\n\nLoop = 999\n-- 设置循环几次就结束\n\nFishingAetheryte = \"胡萨塔伊驿镇\"\n-- 填写离钓场最近的以太之光名字\n\nFishingZoneID = 1190\n\nUnmountPosition = {-79.51,-24.55,739.49}\n-- 下坐骑位置\n\nFishingPosition = {-82.69,-29.39,748.39}\n-- 钓场位置，确保从下坐骑位置走到钓场位置时，你的面向是可以抛竿的\n\nadditional_scrip_exchange = true\n--使用自定义提交收藏品地点，默认为九号解决方案，如果为false则前往军队所在主城提交收藏品\n\nadditional_scrip_exchange_location    = \"九号解决方案\" \n--自定义提交收藏品的大水晶名称\n\nadditional_scrip_exchange_sublocation = \"联合商城\"   \n--自定义城内小水晶名称，当需要使用城内小水晶移动时使用\n\ninterval_rate = 0.5\n--兑换时交互速度，单位为s，如果会卡住可以适当增大\n\nnum_inventory_free_slot_threshold = 5\n--当背包剩余空间小于该值时将停止钓鱼前往兑换票据\n\ndo_extract = true\n--是否自动精炼\ndo_repair = true\n--是否自动修理（如果开启了DR的自动修理则不用启用）\n\nfood_to_eat = \"\"\n--吃什么食物（不想使用请留空 \"\" ）脚本不会检查你是否有这种道具，没有的话会自动跳过。\nmedicine_to_use = \"极精炼药 <hq>\" \n--吃什么药（不想使用请留空 \"\" ）脚本不会检查你是否有这种道具，没有的话会自动跳过。\n\nconsume_threshold = 10 \n--食物剩余多少分钟后补充\nRepairAmount = 50 \n--修理阈值\n\nstart_fishing_command_1 = \"/e 空天姬预设 佐戈秃鹰\"\nstart_fishing_command_2 = \"\"\n--开始钓鱼时使用的指令，按顺序执行，如不需要可留空\n\nstop_fishing_command_1 = \"/e 停止\"\nstop_fishing_command_2 = \"/ac 中断\"\n--停止钓鱼时使用的指令，按顺序执行，如不需要可留空\n\njob_change_command = \"/gearset change 捕鱼人\"\n--填写你捕鱼人职业套装列表的序号或者套装名字 如\"/gearset change 3\" 可自行在聊天栏测试能不能切换到捕鱼人职业\n\nexchange_item_table      = {\n    { 4, 8, 6, 1000 }, --橙票用于兑换 (默认为犎牛角笛的交换票据)\n    { 4, 1, 0, 20 },  --紫票用于兑换 (默认为高级强心剂)\n} --只能分别设置一个要兑换的物品\n\ncollectible_item_table   ={ --用于提交的收藏品列表\n    --橙票收藏品\n    { 6, 43761, 10, 39 }, --佐戈秃鹰\n    --紫票收藏品\n    { 28, 44233, 10, 38 }, --灵岩之剑\n    --格式为{ 收藏品在提交界面所在行数 , 物品id , 提交职业（捕鱼人为10）, 票据id（橙票为39，紫票为38） }\n}\n\n\nmin_items_before_turnins = 1             \n--how many collectibles before turining in\nscrip_overcap_limit      = 3900          \n--橙票/紫票大于该值时停止提交收藏品，以防止溢出\n\n\n----------以下设置，除非你知道你在做什么，否则请保持原样----------\n\npaths_to_scrip                        = { --票据兑换的路径\n    { -258.09,  16.079, 42.089,  129 }, -- 利姆萨·罗敏萨下层甲板\n    { 142.15,   13.74,  -105.39, 132 },-- 格里达尼亚新街\n    { 149.349,  4,      -18.722, 130 },-- 乌尔达哈现世回廊\n    { -158.019, 0.922, -37.884, 1186} -- 九号解决方案\n\n}\n\nmsgDelay = 10\ntimeout_threshold = 10\n\nstop_main = false\n\nfunction Dismount()-- 下坐骑\n    if GetCharacterCondition(77) then\n        yield('/gaction 随机坐骑')\n        local muuv = 1\n        local muuvX = GetPlayerRawXPos()\n        local muuvY = GetPlayerRawYPos()\n        local muuvZ = GetPlayerRawZPos()\n        while muuv == 1 do\n           yield(\"/wait \" .. interval_rate*5)\n           if muuvX == GetPlayerRawXPos() and muuvY == GetPlayerRawYPos() and muuvZ == GetPlayerRawZPos() then\n               muuv = 0\n           end\n           muuvX = GetPlayerRawXPos()\n           muuvY = GetPlayerRawYPos()\n           muuvZ = GetPlayerRawZPos()\n        end\n\n        if GetCharacterCondition(77) then\n            local random_j = 0\n            ::DISMOUNT_START::\n            CheckNavmeshReady()\n\n            local land_x\n            local land_y\n            local land_z\n            local i = 0\n            while not land_x or not land_y or not land_z do\n                land_x = QueryMeshPointOnFloorX(GetPlayerRawXPos() + math.random(0, random_j),\n                    GetPlayerRawYPos() + math.random(0, random_j), GetPlayerRawZPos() + math.random(0, random_j), false, i)\n                land_y = QueryMeshPointOnFloorY(GetPlayerRawXPos() + math.random(0, random_j),\n                    GetPlayerRawYPos() + math.random(0, random_j), GetPlayerRawZPos() + math.random(0, random_j), false, i)\n                land_z = QueryMeshPointOnFloorZ(GetPlayerRawXPos() + math.random(0, random_j),\n                    GetPlayerRawYPos() + math.random(0, random_j), GetPlayerRawZPos() + math.random(0, random_j), false, i)\n                i = i + 1\n            end\n            NodeMoveFly(\"land,\" .. land_x .. \",\" .. land_y .. \",\" .. land_z)\n\n\n            local timeout_start = os.clock()\n            repeat\n                yield(\"/wait \" .. interval_rate)\n                if os.clock() - timeout_start > timeout_threshold then\n                    Id_Print(\"未能导航到可下坐骑的地形\")\n                    Id_Print(\"尝试前往其他位置\")\n                    random_j = random_j + 1\n                    goto DISMOUNT_START\n                end\n            until not PathIsRunning()\n\n            yield('/gaction 随机坐骑')\n\n            timeout_start = os.clock()\n            repeat\n                yield(\"/wait \" .. interval_rate)\n                if os.clock() - timeout_start > timeout_threshold then\n                    Id_Print(\"下坐骑失败\")\n                    Id_Print(\"尝试前往其他位置\")\n                    random_j = random_j + 1\n                    goto DISMOUNT_START\n                end\n            until not GetCharacterCondition(77)\n        end\n    end\n\n    if GetCharacterCondition(4) then\n        yield(\"/wait \" .. interval_rate*10)\n        yield('/gaction 随机坐骑')\n        repeat\n            yield(\"/wait \" .. interval_rate)\n        until not GetCharacterCondition(4)\n    end\nend\n\nfunction ParseNodeDataString(string)\n    return Split(string, \",\")\nend\n\nfunction PrintNode(node)\n    local printable_node = node or \"\"\n    if truncate then\n        local data = ParseNodeDataString(node)\n        local x = Truncate1Dp(data[2])\n        local y = Truncate1Dp(data[3])\n        local z = Truncate1Dp(data[4])\n        printable_node = data[1] .. \",\" .. x .. \",\" .. y .. \",\" .. z\n    end\n    return printable_node\nend\n\nfunction Split(inputstr, sep)\n    if sep == nil then sep = \"%s\" end\n    local t = {}\n    for str in string.gmatch(inputstr, \"([^\" .. sep .. \"]+)\") do\n        table.insert(t, str)\n    end\n    return t\nend\n\nfunction NodeMoveFly(node, force_moveto)\n    local force_moveto = force_moveto or false\n    local x = tonumber(ParseNodeDataString(node)[2]) or 0\n    local y = tonumber(ParseNodeDataString(node)[3]) or 0\n    local z = tonumber(ParseNodeDataString(node)[4]) or 0\n    last_move_type = last_move_type or \"NA\"\n\n    CheckNavmeshReady()\n    start_pos = Truncate1Dp(GetPlayerRawXPos()) ..\n        \",\" .. Truncate1Dp(GetPlayerRawYPos()) .. \",\" .. Truncate1Dp(GetPlayerRawZPos())\n    if not force_moveto and ((GetCharacterCondition(4) and GetCharacterCondition(77)) or GetCharacterCondition(81)) then\n        last_move_type = \"fly\"\n        PathfindAndMoveTo(x, y, z, true)\n    else\n        last_move_type = \"walk\"\n        PathfindAndMoveTo(x, y, z)\n    end\nend\n\nfunction UseMedicine()--Wrapper for eating food, and if want to consume, consume if not fooded\n    if type(medicine_to_use) ~= \"string\" and type(medicine_to_use) ~= \"table\" then return end\n    if medicine_to_use == \"\" then return end\n\n    if not HasStatus(\"强化药\") then\n        local timeout_start = os.clock()\n        local user_settings = { GetSNDProperty(\"UseItemStructsVersion\"), GetSNDProperty(\"StopMacroIfItemNotFound\"),\n            GetSNDProperty(\"StopMacroIfCantUseItem\") }\n        SetSNDProperty(\"UseItemStructsVersion\", \"true\")\n        SetSNDProperty(\"StopMacroIfItemNotFound\", \"false\")\n        SetSNDProperty(\"StopMacroIfCantUseItem\", \"false\")\n        repeat\n            if type(medicine_to_use) == \"string\" then\n                Id_Print(\"尝试使用 \" .. medicine_to_use)\n                yield(\"/item \" .. medicine_to_use)\n            elseif type(medicine_to_use) == \"table\" then\n                for _, medicine in ipairs(medicine_to_use) do\n                    Id_Print(\"尝试使用 \" .. medicine, verbose)\n                    yield(\"/item \" .. medicine)\n                    yield(\"/wait \" .. math.max(interval_rate, 1))\n                    if HasStatus(\"强化药\") then break end\n                end\n            end\n\n            yield(\"/wait \" .. math.max(interval_rate, 1))\n        until HasStatus(\"强化药\") or os.clock() - timeout_start > consume_threshold\n        SetSNDProperty(\"UseItemStructsVersion\", tostring(user_settings[1]))\n        SetSNDProperty(\"StopMacroIfItemNotFound\", tostring(user_settings[2]))\n        SetSNDProperty(\"StopMacroIfCantUseItem\", tostring(user_settings[3]))\n    end\nend\n\nfunction EatFood()\n    if type(food_to_eat) ~= \"string\" and type(food_to_eat) ~= \"table\" then return end\n    if food_to_eat == \"\" then return end\n\n    if not HasStatus(\"进食\") then\n        local timeout_start = os.clock()\n        local user_settings = { GetSNDProperty(\"UseItemStructsVersion\"), GetSNDProperty(\"StopMacroIfItemNotFound\"),\n            GetSNDProperty(\"StopMacroIfCantUseItem\") }\n        SetSNDProperty(\"UseItemStructsVersion\", \"true\")\n        SetSNDProperty(\"StopMacroIfItemNotFound\", \"false\")\n        SetSNDProperty(\"StopMacroIfCantUseItem\", \"false\")\n        repeat\n            if type(food_to_eat) == \"string\" then\n                Id_Print(\"尝试使用 \" .. food_to_eat)\n                yield(\"/item \" .. food_to_eat)\n            elseif type(food_to_eat) == \"table\" then\n                for _, food in ipairs(food_to_eat) do\n                    Id_Print(\"尝试使用 \" .. food, verbose)\n                    yield(\"/item \" .. food)\n                    yield(\"/wait \" .. math.max(interval_rate, 1))\n                    if HasStatus(\"进食\") then break end\n                end\n            end\n\n            yield(\"/wait \" .. math.max(interval_rate, 1))\n        until HasStatus(\"进食\") or os.clock() - timeout_start > consume_threshold\n        SetSNDProperty(\"UseItemStructsVersion\", tostring(user_settings[1]))\n        SetSNDProperty(\"StopMacroIfItemNotFound\", tostring(user_settings[2]))\n        SetSNDProperty(\"StopMacroIfCantUseItem\", tostring(user_settings[3]))\n    end\nend\n\nfunction RepairExtractCheck()--修理装备与精炼\n\n    function SelfRepair()\n        if do_repair and NeedsRepair(RepairAmount) then\n            StopMoveFly()\n            if GetCharacterCondition(4) then\n                Id_Print(\"[自动钓收藏品] 尝试下坐骑\")\n                Dismount()\n            end\n            while not IsAddonVisible(\"Repair\") do\n                yield(\"/gaction 修理\")\n                yield(\"/wait \" .. interval_rate * 5)\n            end\n            yield(\"/callback Repair true 0\")\n            yield(\"/wait \" .. interval_rate)\n            if GetNodeText(\"_TextError\", 1) == \"没有修理所必需的暗物质。\" and\n                IsAddonVisible(\"_TextError\") then\n                LogInfo(\"[自动钓收藏品] 修理所必需的暗物质不足\")\n            end\n            if IsAddonVisible(\"SelectYesno\") then\n                yield(\"/callback SelectYesno true 0\")\n            end\n            while GetCharacterCondition(39) do\n                yield(\"/wait \" .. interval_rate * 10)\n            end\n            yield(\"/wait \" .. interval_rate * 10)\n            if IsAddonVisible(\"Repair\") then\n                yield(\"/callback Repair true -1\")\n            end\n            Id_Print(\"[自动钓收藏品] 修理完成\")\n        end\n    end\n\n    SelfRepair()\n    \n    function MateriaExtract()\n        if do_extract and CanExtractMateria(100) then\n            StopMoveFly()\n            if GetCharacterCondition(4) then\n                Id_Print(\"[自动钓收藏品] 尝试下坐骑\")\n                Dismount()\n            end\n            Id_Print(\"尝试精制魔晶石\")\n            yield(\"/gaction 精制魔晶石\")\n            yield(\"/waitaddon Materialize\")\n\n            while CanExtractMateria(100) == true do\n                yield(\"/callback Materialize true 2 0\")\n                yield(\"/wait \" .. interval_rate * 5)\n                if IsAddonVisible(\"MaterializeDialog\") then\n                    yield(\"/callback MaterializeDialog true 0\")\n                end\n                while GetCharacterCondition(39) do\n                    yield(\"/wait \" .. interval_rate * 30)\n                end\n                yield(\"/wait \" .. interval_rate * 20)\n            end\n\n            yield(\"/wait \" .. interval_rate * 10)\n            yield(\"/callback Materialize true -1\")\n            Id_Print(\"[自动钓收藏品] 精制魔晶石完成\")\n        end\n    end\n    MateriaExtract()\nend\n\nfunction CollectableAppraiser()--提交收藏品\n    while not IsAddonVisible(\"CollectablesShop\") and not IsAddonReady(\"CollectablesShop\") do\n        if GetTargetName() ~= \"收藏品交易员\" then\n            yield(\"/target 收藏品交易员\")\n        elseif not IsAddonVisible(\"SelectIconString\") then\n            yield(\"/interact\")\n        else\n            yield(\"/callback SelectIconString true 0\")\n        end\n        yield(\"/wait \" .. interval_rate)\n    end\n    yield(\"/wait \" .. interval_rate * 10)\n\n\n    local orange_scrips_raw = GetNodeText(\"CollectablesShop\", 39, 1):gsub(\",\", \"\"):match(\"^([%d,]+)/\")\n    local purple_scrips_raw = GetNodeText(\"CollectablesShop\", 38, 1):gsub(\",\", \"\"):match(\"^([%d,]+)/\")\n\n    local orange_scrips = tonumber(orange_scrips_raw)\n    local purple_scrips = tonumber(purple_scrips_raw)\n\n    if (orange_scrips < scrip_overcap_limit) or (purple_scrips < scrip_overcap_limit) then\n        for i, item in ipairs(collectible_item_table) do\n            local collectible_to_turnin_row = item[1]\n            local collectible_item_id = item[2]\n            local job_for_turnin = item[3]\n            local turnins_scrip_type = item[4]\n            yield(\"/e 提交道具: \" .. collectible_item_id)\n            if GetItemCount(collectible_item_id) > 0 then\n                yield(\"/callback CollectablesShop true 14 \" .. job_for_turnin)\n                yield(\"/wait \" .. interval_rate * 2)\n                yield(\"/callback CollectablesShop true 12 \" .. collectible_to_turnin_row)\n                yield(\"/wait \" .. interval_rate * 2)\n                scrips_owned = tonumber(GetNodeText(\"CollectablesShop\", turnins_scrip_type, 1):gsub(\",\", \"\"):match(\n                \"^([%d,]+)/\"))\n                while (scrips_owned <= scrip_overcap_limit) and (not IsAddonVisible(\"SelectYesno\")) and (GetItemCount(collectible_item_id) > 0) do\n                    --iyield(\"ITEM: \" .. collectible_item_id .. \" Qty: \" .. GetItemCount(collectible_item_id))\n                    yield(\"/callback CollectablesShop true 15 0\")\n                    yield(\"/wait \" .. interval_rate * 2)\n                    scrips_owned = tonumber(GetNodeText(\"CollectablesShop\", turnins_scrip_type, 1):gsub(\",\", \"\"):match(\n                    \"^([%d,]+)/\"))\n                end --will break if either orange or purple scrip limit cap reached\n                yield(\"/wait \" .. interval_rate * 2)\n            end\n            yield(\"/wait \" .. interval_rate)\n            if IsAddonVisible(\"SelectYesno\") then\n                yield(\"/callback SelectYesno true 1\")\n                break\n            end\n        end\n    end\n    yield(\"/wait \" .. interval_rate * 2)\n    yield(\"/callback CollectablesShop true -1\")\n\n    if GetTargetName() ~= \"\" then\n        ClearTarget()\n        yield(\"/wait \" .. interval_rate)\n    end\nend\n\nfunction ScripExchange()-- 兑换票据\n    --打开兑换界面--\n    while not IsAddonVisible(\"InclusionShop\") and not IsAddonReady(\"InclusionShop\") do\n        if GetTargetName() ~= \"工票交易员\" then\n            yield(\"/target 工票交易员\")\n        elseif not IsAddonVisible(\"SelectIconString\") then\n            yield(\"/interact\")\n        else\n            yield(\"/callback SelectIconString true 0\")\n        end\n        yield(\"/wait \" .. interval_rate)\n    end\n\n    yield(\"/wait \" .. interval_rate * 10)\n\n    --打开对应目录--\n    for i, reward in ipairs(exchange_item_table) do\n        local scrip_exchange_category = reward[1]\n        local scrip_exchange_subcategory = reward[2]\n        local scrip_exchange_item_to_buy_row = reward[3]\n        local collectible_scrip_price = reward[4]\n        yield(\"需要票据:\" .. collectible_scrip_price)\n\n        yield(\"/wait \" .. interval_rate * 5)\n        yield(\"/callback InclusionShop true 12 \" .. scrip_exchange_category)\n        yield(\"/wait \" .. interval_rate)\n        yield(\"/callback InclusionShop true 13 \" .. scrip_exchange_subcategory)\n        yield(\"/wait \" .. interval_rate)\n\n        --开始兑换--\n        scrips_owned_str = GetNodeText(\"InclusionShop\", 21):gsub(\",\", \"\")\n        scrips_owned = tonumber(scrips_owned_str)\n        if scrips_owned >= collectible_scrip_price then\n            scrip_shop_item_row = scrip_exchange_item_to_buy_row + 21\n            scrip_item_number_to_buy = scrips_owned // collectible_scrip_price\n            local scrip_item_number_to_buy_final = math.min(scrip_item_number_to_buy, 99)\n            yield(\"/callback InclusionShop true 14 \" ..\n                scrip_exchange_item_to_buy_row .. \" \" .. scrip_item_number_to_buy_final)\n            yield(\"/wait \" .. interval_rate * 5)\n            if IsAddonVisible(\"ShopExchangeItemDialog\") then\n                yield(\"/callback ShopExchangeItemDialog true 0\")\n                yield(\"/wait \" .. interval_rate)\n            end\n        end\n    end\n    --结束兑换--\n    yield(\"/wait \" .. interval_rate)\n    yield(\"/callback InclusionShop true -1\")\n\n    if GetTargetName() ~= \"\" then\n        ClearTarget()\n        yield(\"/wait \" .. interval_rate)\n    end\nend\n\nfunction PathToScrip()-- 前往收藏品交易位置\n    if additional_scrip_exchange then\n        local x = paths_to_scrip[4][1]\n        local y = paths_to_scrip[4][2]\n        local z = paths_to_scrip[4][3]\n\n        local zoneid = paths_to_scrip[4][4]\n        yield(\"/vnav stop\")\n\n        yield(\"/tp \" .. additional_scrip_exchange_location)\n        yield(\"/wait \" .. interval_rate * 15)\n        repeat\n            yield(\"/wait \" .. interval_rate)\n        until (zoneid == GetZoneID()) and (not GetCharacterCondition(27)) and (not GetCharacterCondition(45)) and (not GetCharacterCondition(51))\n        yield(\"/wait \" .. interval_rate * 10)\n        yield(\"/li \" .. additional_scrip_exchange_sublocation)\n        yield(\"/wait \" .. interval_rate * 30)\n        MoveTo(x, y, z, 0.1, false)\n        yield(\"/wait \" .. interval_rate * 10)\n    else\n        TeleportToGCTown()\n        local gc_no = GetPlayerGC()\n        if gc_no == 1 then\n            local zoneid = paths_to_scrip[1][4]\n            local x = paths_to_scrip[1][1]\n            local y = paths_to_scrip[1][2]\n            local z = paths_to_scrip[1][3]\n            repeat\n                yield(\"/wait \" .. interval_rate)\n            until (zoneid == GetZoneID()) and (not GetCharacterCondition(27)) and (not GetCharacterCondition(45)) and (not GetCharacterCondition(51))\n            --yield(\"/wait \" .. interval_rate * 20)\n            --yield(\"/li hawkers\")\n            yield(\"/wait \" .. interval_rate * 50)\n            PathfindAndMoveTo(x, y, z, false)\n        elseif gc_no == 2 then\n            local zoneid = paths_to_scrip[2][4]\n            local x = paths_to_scrip[2][1]\n            local y = paths_to_scrip[2][2]\n            local z = paths_to_scrip[2][3]\n            repeat\n                yield(\"/wait \" .. interval_rate)\n            until (zoneid == GetZoneID()) and (not GetCharacterCondition(27)) and (not GetCharacterCondition(45)) and (not GetCharacterCondition(51))\n            yield(\"/li leatherworker\")\n            yield(\"/wait \" .. interval_rate * 50)\n            PathfindAndMoveTo(x, y, z, false)\n        elseif gc_no == 3 then\n            local zoneid = paths_to_scrip[3][4]\n            local x = paths_to_scrip[3][1]\n            local y = paths_to_scrip[3][2]\n            local z = paths_to_scrip[3][3]\n            repeat\n                yield(\"/wait \" .. interval_rate)\n            until (zoneid == GetZoneID()) and (not GetCharacterCondition(27)) and (not GetCharacterCondition(45)) and (not GetCharacterCondition(51))\n            yield(\"/li sapphire\")\n            yield(\"/wait \" .. interval_rate * 50)\n            PathfindAndMoveTo(x, y, z, false)\n        end\n        yield(\"/wait \" .. interval_rate)\n        if PathIsRunning() then\n            repeat\n                yield(\"/wait \" .. interval_rate)\n            until not PathIsRunning()\n        end\n    end\nend\n\nfunction CanTurnin()-- 可以提交收藏品\n    local flag = false\n    for i, item in ipairs(collectible_item_table) do\n        local collectible_item_id = item[2]\n        if GetItemCount(collectible_item_id) >= min_items_before_turnins then\n            flag = true --turnin even if one item is available for turnins\n        end\n    end\n    return flag\nend\n\nfunction CollectableAppraiserScripExchange()-- 提交然后兑换\n    if IsPlayerAvailable() then\n        PathToScrip()\n        yield(\"/wait \" .. interval_rate * 2)\n        while CanTurnin() do\n            CollectableAppraiser()\n            yield(\"/wait \" .. interval_rate * 5)\n            ScripExchange()\n            yield(\"/wait \" .. interval_rate * 5)\n        end\n        yield(\"/wait \" .. interval_rate * 1)\n        ScripExchange()\n    end\nend\n\nfunction PluginsCheck()-- 检查需要插件\n    if not HasPlugin(\"Lifestream\") then\n    yield(\"/e 请安装Lifestream\")\n    Check= false\n    end\n\n    if not HasPlugin(\"vnavmesh\") then\n    yield(\"/e 请安装vnavmesh\")\n    Check= false\n    end\n\n    if not HasPlugin(\"TeleporterPlugin\") then\n    yield(\"/e 请安装Teleporter\")\n    Check= false\n    end\nend\n\nfunction StopMoveFly()\n    PathStop()\n    while PathIsRunning() do\n        yield(\"/wait \" .. interval_rate)\n    end\nend\n\nfunction VNavMovement() -- Used to Do NOTHING While Moving\n    repeat\n        yield(\"/wait \" .. interval_rate * 10)\n    until not PathIsRunning()\nend\n\nfunction CheckNavmeshReady()\n    was_ready = NavIsReady()\n    while not NavIsReady() do\n        Id_Print(\"Building navmesh, currently at \" .. Truncate1Dp(NavBuildProgress() * 100) .. \"%\")\n        yield(\"/wait \" .. (interval_rate * 10))\n    end\n    if not was_ready then Id_Print(\"Navmesh is ready!\") end\nend\n\nfunction MoveTo(valuex, valuey, valuez, stopdistance, FlyOrWalk)\n    function MeshCheck()\n        function Truncate1Dp(num)\n            return truncate and (\"%.1f\"):format(num) or num\n        end\n\n        local was_ready = NavIsReady()\n        if not NavIsReady() then\n            while not NavIsReady() do\n                LogInfo(\"[Debug]Building navmesh, currently at \" .. Truncate1Dp(NavBuildProgress() * 100) .. \"%\")\n                yield(\"/wait 1\")\n                local was_ready = NavIsReady()\n                if was_ready then\n                    LogInfo(\"[Debug]Navmesh ready!\")\n                end\n            end\n        else\n            LogInfo(\"[Debug]Navmesh ready!\")\n        end\n    end\n\n    MeshCheck()\n    \n    local CastingMount = false\n    \n    if FlyOrWalk then\n        if TerritorySupportsMounting() then\n            while GetCharacterCondition(4, false) do\n                yield(\"/wait 2\")\n                -- 检查是否正在读条或坐骑中\n                if GetCharacterCondition(27) then\n                    yield(\"/wait 1\")\n                    repeat\n                    yield(\"/wait 0.5\")\n                    until not GetCharacterCondition(27) -- 等待读条状态结束\n                    yield(\"/wait 1\")\n\n                    -- 如果未开始上坐骑且不在飞行中\n                    elseif not CastingMount and not GetCharacterCondition(4) then\n                    yield('/gaction 随机坐骑') -- 触发上坐骑\n                    CastingMount = true        -- 标志为已经尝试上坐骑\n                    yield(\"/wait 1\")\n\n                -- 如果已经尝试过上坐骑，等待状态稳定\n                else\n                    yield(\"/wait 1\")\n                end\n\n                -- 如果检测到角色已经上坐骑，重置标志\n                if GetCharacterCondition(4) then\n                    CastingMount = false\n                end\n            end\n\n\n\n        if HasFlightUnlocked(GetZoneID()) then\n            PathfindAndMoveTo(valuex, valuey, valuez, true) -- flying\n        else\n            LogInfo(\"[MoveTo] 无法飞行，尝试行走\")\n            PathfindAndMoveTo(valuex, valuey, valuez, false) -- walking\n        end\n    else\n        LogInfo(\"[MoveTo] 无法上坐骑，尝试行走\")\n        PathfindAndMoveTo(valuex, valuey, valuez, false) -- walking\n    end\nelse\n    PathfindAndMoveTo(valuex, valuey, valuez, false) -- walking\nend\nwhile ((PathIsRunning() or PathfindInProgress()) and GetDistanceToPoint(valuex, valuey, valuez) > stopdistance) do\n    yield(\"/wait 0.3\")\nend\nPathStop()\nLogInfo(\"[MoveTo] 完成\")\nend\n\nfunction setSNDPropertyIfNotSet(propertyName)\n    if GetSNDProperty(propertyName) == false then\n        SetSNDProperty(propertyName, \"true\")\n        LogInfo(\"[SetSNDPropertys] \" .. propertyName .. \" set to True\")\n    end\nend\n\nfunction unsetSNDPropertyIfSet(propertyName)\n    if GetSNDProperty(propertyName) then\n        SetSNDProperty(propertyName, \"false\")\n        LogInfo(\"[SetSNDPropertys] \" .. propertyName .. \" set to False\")\n    end\nend\n\nfunction Truncate1Dp(num)\n    return truncate and (\"%.1f\"):format(num) or num\nend\n\nfunction Set(list)\n    local set = {}\n    for _, l in ipairs(list) do set[l] = true end\n    return set\nend\n\nfunction AddToSet(set, key)\n    set[key] = true\nend\n\nfunction Id_Print(string, print, debug)-- 打印调试信息\n    local time = -msgDelay\n    if print == nil then print = true end\n    if debug == nil then debug = false end\n    print_history = print_history or Set {}\n    script_start = script_start or os.clock()\n\n    if debug then\n        LogDebug(\"[自动钓收藏品] [DEBUG] \" .. string)\n        return\n    end\n\n    for k, _ in pairs(print_history) do\n        entry = Split(k, \"_\")\n        if entry and time < tonumber(entry[1]) and entry[2] == string then\n            time = tonumber(entry[1])\n        end\n    end\n\n    if print and os.clock() - script_start >= time + msgDelay then\n        yield(\"/echo [自动钓收藏品] \" .. string)\n        AddToSet(print_history, (os.clock() - script_start) .. \"_\" .. string)\n    end\nend\n\nfunction StopFishing()\n\n  yield(\"/wait \" .. interval_rate)\n    if (GetCharacterCondition(6) or GetCharacterCondition(42) or GetCharacterCondition(27) or GetCharacterCondition(51)) then\n        yield(\"/e 下次上钩后停止钓鱼\")\n        repeat  \n            yield(\"/wait \" .. interval_rate)\n        until GetCharacterCondition(42)\n        yield(stop_fishing_command_1)\n        yield(\"/wait \" .. interval_rate)\n        repeat  \n            yield(\"/wait \" .. interval_rate*10)\n            yield(\"/wait \" .. interval_rate)\n            yield(stop_fishing_command_2)\n        until not GetCharacterCondition(6) and not GetCharacterCondition(42) \n        \n    else    \n        yield(stop_fishing_command_1)\n        yield(\"/wait \" .. interval_rate)\n        yield(stop_fishing_command_2)\n        yield(\"/wait \" .. interval_rate*10)\n    end\n\nend    \n\nfunction ContinueFishing()\n    while not (IsInZone(FishingZoneID)) do\n            yield(\"/wait \" .. interval_rate*10)\n        if GetCharacterCondition(27) or GetCharacterCondition(45) or GetCharacterCondition(51) then\n            yield(\"/wait \" .. interval_rate*10)\n        else\n            yield(\"/tp \"..FishingAetheryte)\n        end\n    end\n    \n    if GetDistanceToPoint(UnmountPosition[1],UnmountPosition[2],UnmountPosition[3]) > 20 then\n    MoveTo(UnmountPosition[1],UnmountPosition[2],UnmountPosition[3],0,true)\n    yield(\"/wait \" .. interval_rate)\n    end\n    Dismount()\n    yield(\"/wait \" .. interval_rate)\n    MoveTo(FishingPosition[1],FishingPosition[2],FishingPosition[3],0,false)\n    yield(\"/wait \" .. interval_rate)\n    yield(start_fishing_command_1)\n    yield(\"/wait \" .. interval_rate)\n    yield(start_fishing_command_2)\n\nend\n\nfunction Main()\n    -----------------------------------------------------------------------------\n    i_count = tonumber(GetInventoryFreeSlotCount())\n    --wait while gathering status\n    while (not (i_count < num_inventory_free_slot_threshold)) and (not CanExtractMateria(100)) do\n        yield(\"/wait \" .. interval_rate * 200)\n        i_count = tonumber(GetInventoryFreeSlotCount())\n    end\n    ---------------------------------------------------------------------------------\n\n    --waiting to complete last bit of gathering status\n    if (GetCharacterCondition(6) or GetCharacterCondition(42)) then\n        yield(\"/wait \" .. interval_rate * 24)\n    end\n\n    yield(\"/echo [自动钓收藏品] 停止钓鱼，执行其他任务\")\n    yield(\"/echo [自动钓收藏品] 正在检查食药, 精制魔晶石, 修理装备并提交收藏品\")\n    StopFishing()\n    yield(\"/wait \" .. interval_rate * 10)\n\n    --On site tasks\n    yield(\"/wait \" .. interval_rate * 10)\n    Dismount()\n    yield(\"/wait \" .. interval_rate * 10)\n    RepairExtractCheck()\n    yield(\"/wait \" .. interval_rate * 10)\n    UseMedicine()\n    yield(\"/wait \" .. interval_rate * 15)\n    EatFood()\n    yield(\"/wait \" .. interval_rate * 15)\n\n    i_count = tonumber(GetInventoryFreeSlotCount())\n    if i_count < num_inventory_free_slot_threshold then\n        yield(\"/echo [自动钓收藏品] 正在前往收藏品交易位置\")\n        CollectableAppraiserScripExchange()\n    end\n    yield(\"/wait \" .. interval_rate * 20)\n    yield(\"/echo [自动钓收藏品] 继续钓鱼\")\n    ContinueFishing()\n\n    -------------------------------------------------------------------------------\nend\n\ni_count = tonumber(GetInventoryFreeSlotCount())\nDismount()\nPluginsCheck()\n\nif not Check then\n    if (GetClassJobId()~=18) then\n        yield(job_change_command)\n    end\n    yield(\"/wait \" .. interval_rate * 10)\n    yield(\"/wait \" .. interval_rate * 10)\n    yield(\"/echo [自动钓收藏品] 开始自动钓收藏品\")\n    yield(\"/wait \" .. interval_rate * 10)\n    RepairExtractCheck()\n    yield(\"/wait \" .. interval_rate * 10)\n    UseMedicine()\n    yield(\"/wait \" .. interval_rate * 10)\n    EatFood()\n    yield(\"/wait \" .. interval_rate * 10)\n    --inventory after reduce\n    i_count = tonumber(GetInventoryFreeSlotCount())\n    if (i_count < num_inventory_free_slot_threshold) and CanTurnin() then\n        yield(\"/echo [自动钓收藏品] 前往提交收藏品并兑换\")\n        CollectableAppraiserScripExchange()\n        yield(\"/wait \" .. interval_rate * 30)\n    end\n\n    ContinueFishing()\n    setSNDPropertyIfNotSet(\"UseSNDTargeting\")\n    unsetSNDPropertyIfSet(\"StopMacroIfTargetNotFound\")\n    while not stop_main do\n        i_count = tonumber(GetInventoryFreeSlotCount())\n        yield(\"/echo [自动钓收藏品] 开始钓鱼\")\n        yield(\"/wait \" .. interval_rate)\n                Loop = Loop - 1\n                Main()\n                if Loop == 0 then\n                    stop_main = true\n                    yield(\"/echo [自动钓收藏品] 完成指定次数，结束任务\")\n                end\n        yield(\"/echo [自动钓收藏品] 剩余循环次数： \" .. Loop)\n        yield(\"/wait \" .. interval_rate)\n    end\nelse\n    yield(\"/e 请安装对应插件\")\nend",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 2
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "fate",
        "Gist": "",
        "Contents": "--[[\n\n********************************************************************************\n*                             Multi Zone Farming                               *\n*                                Version 1.0.1                                 *\n********************************************************************************\n\nMulti zone farming script meant to be used with `Fate Farming.lua`. This will go\ndown the list of zones and farm fates until there are no eligible fates left,\nthen teleport to the next zone and restart the fate farming script.\n\nCreated by: pot0to (https://ko-fi.com/pot0to)\n        \n    -> 1.0.1    Added check for death and unexpected combat\n                First release\n\n--#region Settings\n\n--[[\n********************************************************************************\n*                                   Settings                                   *\n********************************************************************************\n]]\n\nFateMacro = \"fate2\"      -- 你给fate SND 脚本起的名字\n\n-- Ctrl+F through Fate Farming.lua to find the zoneIds, or find them in Godbert\nZonesToFarm =\n{\n    --{ zoneName = \"雷克兰德\", zoneId = 813 },\n    --{ zoneName = \"珂露西亚岛\", zoneId = 814 },\n    --{ zoneName = \"安穆·艾兰\", zoneId = 815 },\n    --{ zoneName = \"伊尔美格\", zoneId = 816 },\n    --{ zoneName = \"拉凯提卡大森林\", zoneId = 817 },\n    --{ zoneName = \"黑风海\", zoneId = 818 },\n    { zoneName = \"迷津\", zoneId = 956 },\n    { zoneName = \"萨维奈岛\", zoneId = 957 },\n    { zoneName = \"加雷马\", zoneId = 958 },\n    { zoneName = \"叹息海\", zoneId = 959 },\n    { zoneName = \"天外天垓\", zoneId = 960 },\n    { zoneName = \"活着的记忆\", zoneId = 1192 },\n    { zoneName = \"奥阔帕恰山\", zoneId = 1187 },\n    { zoneName = \"克扎玛乌卡湿地\", zoneId = 1188 },\n    { zoneName = \"亚克特尔树海\", zoneId = 1189 },\n    { zoneName = \"夏劳尼荒野\", zoneId = 1190 },\n    { zoneName = \"遗产之地\", zoneId = 1191 },\n    { zoneName = \"活着的记忆\", zoneId = 1192 }\n}\n\n--#endregion Settings\n\n------------------------------------------------------------------------------------------------------------------------------------------------------\n\n--[[\n**************************************************************\n*  Code: Don't touch this unless you know what you're doing  *\n**************************************************************\n]]\n\nCharacterCondition = {\n    casting=27,\n    betweenAreas=45\n}\n\nfunction TeleportTo(aetheryteName)\n    yield(\"/tp \"..aetheryteName)\n    yield(\"/wait 1\") -- wait for casting to begin\n    while GetCharacterCondition(CharacterCondition.casting) do\n        yield(\"/wait 1\")\n    end\n    yield(\"/wait 1\") -- wait for that microsecond in between the cast finishing and the transition beginning\n    while GetCharacterCondition(CharacterCondition.betweenAreas) do\n        yield(\"/wait 1\")\n    end\n    yield(\"/wait 1\")\nend\n\nFarmingZoneIndex = 1\nOldBicolorGemCount = GetItemCount(26807)\nwhile true do\n    if not IsPlayerOccupied() and not IsMacroRunningOrQueued(FateMacro) then\n        if GetCharacterCondition(2) or GetCharacterCondition(26) or GetZoneID() == ZonesToFarm[FarmingZoneIndex].zoneId then\n            LogInfo(\"[MultiZone] Starting FateMacro\")\n            yield(\"/snd run \"..FateMacro)\n            repeat\n                yield(\"/wait 3\")\n            until not IsMacroRunningOrQueued(FateMacro)\n            LogInfo(\"[MultiZone] FateMacro has stopped\")\n            NewBicolorGemCount = GetItemCount(26807)\n            if NewBicolorGemCount == OldBicolorGemCount then\n                --yield(\"/echo Bicolor Count: \"..NewBicolorGemCount)\n                FarmingZoneIndex  = (FarmingZoneIndex % #ZonesToFarm) + 1\n            else\n                OldBicolorGemCount = NewBicolorGemCount\n            end\n        else\n            LogInfo(\"[MultiZone] Teleporting to \"..ZonesToFarm[FarmingZoneIndex].zoneName)\n            TeleportTo(GetAetheryteName(GetAetherytesInZone(ZonesToFarm[FarmingZoneIndex].zoneId)[0]))\n        end\n    end\n    yield(\"/wait 1\")\nend",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 2
      },
      {
        "$type": "SomethingNeedDoing.MacroNode, SomethingNeedDoing",
        "Name": "fate2",
        "Gist": "",
        "Contents": "--[[\n\n********************************************************************************\n*                                Fate Farming                                  *\n*                               Version 2.21.11                                *\n********************************************************************************\n\n\n********************************************************************************\n*                              需要的 dalamud 插件                              *\n********************************************************************************\n\n运行所需的插件：\n\n    -> Something Need Doing [Expanded Edition] : (主插件)   https://puni.sh/api/repository/croizat\n    -> VNavmesh :   (用于自动飞 fate)    https://puni.sh/api/repository/veyn\n    -> 至少一个自动输出插件:\n        -> RotationSolver Reborn: https://raw.githubusercontent.com/FFXIV-CombatReborn/CombatRebornRepo/main/pluginmaster.json       \n        -> BossMod Reborn: https://raw.githubusercontent.com/FFXIV-CombatReborn/CombatRebornRepo/main/pluginmaster.json\n        -> Veyn's BossMod: https://puni.sh/api/repository/veyn\n        -> Wrath Combo: https://love.puni.sh/ment.json\n        -> 其他（此时该插件不由脚本控制，需要你自己控制）\n    -> 至少一个自动走位插件: \n        -> BossMod Reborn: https://raw.githubusercontent.com/FFXIV-CombatReborn/CombatRebornRepo/main/pluginmaster.json\n        -> Veyn's BossMod: https://puni.sh/api/repository/veyn\n    -> TextAdvance: (用于与 fate 的 NPC交互) https://github.com/NightmareXIV/MyDalamudPlugins/raw/main/pluginmaster.json\n    -> Teleporter :  (用于传送至以太之光 [teleport][Exchange][Retainers])\n    -> Lifestream :  (用于换线 [ChangeInstance][Exchange]) https://raw.githubusercontent.com/NightmareXIV/MyDalamudPlugins/main/pluginmaster.json\n\n********************************************************************************\n*                               可选的 dalamud 插件                             *\n********************************************************************************\n\n这些插件是可选的，除非您在设置中启用它，否则不需要：\n\n    -> AutoRetainer : (用于收雇员 [Retainers])   https://love.puni.sh/ment.json\n    -> Deliveroo : (用于交军票 [TurnIn])   https://plugins.carvel.li/\n    -> YesAlready : (用于精制魔晶石)\n\n--------------------------------------------------------------------------------------------------------------------------------------------------------------\n]]\n\n--#region Settings\n\n--[[\n********************************************************************************\n*                                   设置                                       *\n********************************************************************************\n]]\n\n--打 fate 前的设置\nFood                                = \"南瓜浓汤 <hq>\" -- 如果您不想使用任何食物，请将 \"\" 留空。如果是 HQ，则在名称后添加 <hq>，如 \"烧烤暗色茄子 <hq>\"\nPotion                              = \"\"            -- 如果您不想使用任何药水，请将 \"\" 留空。\nShouldSummonChocobo                 = true          -- 设置为 true 将会自动召唤陆行鸟\n    ResummonChocoboTimeLeft         = 3 * 60        -- 如果计时器剩余的时间少于这个数值（单位：秒），则重新召唤陆行鸟，这样它就不会在命运中途消失。\n    ChocoboStance                   = \"治疗战术\"   -- 选择一项填入: 跟随/自由战术/防护战术/进攻战术/治疗战术\n    ShouldAutoBuyGysahlGreens       = true          -- 如果背包里没有基萨尔野菜，会自动去海都商人那里购买 99 个\nMountToUse                          = \"仙子猪大王\" -- 填入坐骑，脚本会使用该坐骑来飞往fate，需要完整、准确的名称\nFatePriority                        = {\"Bonus\", \"Progress\", \"DistanceTeleport\", \"TimeLeft\", \"Distance\"} --FATE 优先级顺序\n--DistanceTeleport=传送距离；Progress=双倍；Bonus=奖励；TimeLeft=剩余时间；Distance=距离\n--默认：{ \"Progress\", \"DistanceTeleport\", \"Bonus\", \"TimeLeft\", \"Distance\"}；现设：{\"Bonus\", \"Progress\", \"DistanceTeleport\", \"TimeLeft\", \"Distance\"}\n\n--Fate 战斗设置\nCompletionToIgnoreFate              = 80            -- 如果 fate 的进度不小于这个百分比，就跳过它\nMinTimeLeftToIgnoreFate             = 3*60          -- 如果 fate 的剩余时间不小于这个数值（单位：秒），就跳过它\nCompletionToJoinBossFate            = 0             -- 如果 boss 型 fate 的进度不大于这个百分比，就跳过它（用以避免单挑 boss）\n    CompletionToJoinSpecialBossFates = 20           -- 如果 boss 型特殊 fate 的进度不大于这个百分比，就跳过它（例如“蛇王得酷热涅：荒野的死斗”、“亩鼠米卡：盛装巡游皆大欢喜”）\n    ClassForBossFates               = \"\"            -- 如果你想让脚本在打 boss 型 fate 时切换另一个职业，请将此值设置为职业的三字母缩写\n                                                    -- 例如：PLD 指代骑士，具体详见下方 CassList 参数\nJoinCollectionsFates                = true          -- 设为 false 则跳过收集型 fate，默认true\nBonusFatesOnly                      = true          -- 设为 true 将只参加有额外奖励的 fate，默认false\n\nMeleeDist                           = 2.5           -- 近战职业攻击距离（用于自动走位插件），建议设为 2.5，若不小于 2.59 将会导致近战职业“无法发动自动攻击，目标在范围之外。”\nRangedDist                          = 20            -- 远程职业攻击距离（用于自动走位插件），建议不大于 25.49\n                                                      -- 特别地，如果你的职业有【以自身为圆心的圆形 aoe】（如诗人等），建议不大于【你的这类技能的攻击距离】\n\nRotationPlugin                      = \"BMR\"         -- 自动输出插件（None 代表不由脚本控制的自动输出插件，比如 AE 等）: RSR/BMR/VBM/Wrath/AE/None\n    -- (RSR)设置预设\n    RSRAoeType                      = \"Full\"        -- RSR 的 AOE 技能类型选择，可选项: Cleave/Full/Off\n\n    -- Boss Mod (VBM) / Boss Mod Reborn (BMR) 预设\n    RotationSingleTargetPreset      = \"autoduty\"    -- 单体输出模式的预设的名称（用于迷失者、迷失少女）\n    RotationAoePreset               = \"autoduty\"    -- AOE 模式的预设的名称\n    RotationHoldBuffPreset          = \"autoduty\"    -- 留爆发模式的预设的名称\n    PercentageToHoldBuff            = 65            -- 当 fate 的进度不小于此百分比数值时，切换为留爆发模式，有助于减少爆发技能的浪费。如果打得太快，该值不小于 70% 时仍然有可能导致爆发溢出\nDodgingPlugin                       = \"BMR\"         -- 自动走位插件: BMR/VBM/None. 如果你使用 BMR/VBM 作为自动输出插件，该值将被忽略\n\nIgnoreForlorns                      = false         -- 设为 true 将不打迷失者、迷失少女\n    IgnoreBigForlornOnly            = false         -- 设为 true 将不打迷失者\n\n--打完 fate\nMinWait                             = 2             -- 出发前往下一个 fate 前等待时间的最小值（单位：秒）\nMaxWait                             = 4             -- 出发前往下一个 fate 前等待时间的最大值（单位：秒）\n                                                        --实际等待时间将是 MinWait 和 MaxWait 之间随机生成的数字。\nDownTimeWaitAtNearestAetheryte      = false         --等待命运出现时，你应该飞到最近的 水晶 并在那里等待吗？\nEnableChangeInstance                = true          -- 设为 true 如果当前分线没有 fate，则切换分线（仅在有分线的地图可用）\n    WaitIfBonusBuff                 = false         -- 如果你有\"危命奖励提高\"buff，则不切换副本区\n    NumberOfInstances               = 2             -- 最大分线数\n\nShouldExchangeBicolorGemstones      = true          -- 设为 true 则在双色宝石即将溢出时兑换双色宝石的收据\n    ItemToPurchase                  = \"图拉尔双色宝石的收据\"        -- 双色宝石的收据/图拉尔双色宝石的收据\nSelfRepair                          = true          -- 自己修理选项，如果设置为 false, 就去 海都找修理工\n    RepairAmount                    = 20            -- 设置一个阈值，低于此阈值将会自动修理装备 (如果不需要自动修理，请将其设置为0)\n    ShouldAutoBuyDarkMatter         = true          -- 如果你没有8级暗物质，则会自动从利姆萨的商人购买一组99个\nShouldExtractMateria                = true          -- 是否要自动精炼魔晶石\nRetainers                           = true          -- 是否自动收雇员\nShouldGrandCompanyTurnIn            = false         -- 是否自动交军票 (需要 Deliveroo 插件)\n    InventorySlotsLeft              = 5             -- 当背包剩余空间小于此值时开始交军票\n\nEcho                                = \"All\"         --设置: All/Gems/None\nChatCommandType                     = \"e\"           -- 发送下一个fate的目标到聊天 可以改成 `e`  `p` 或其他 与游戏原生宏相同\n\nCompanionScriptMode                 = true          --如果您将fate脚本与配套脚本（如Atma Farmer）一起使用，则设置为true\n\n--#endregion Settings\n\n--[[\n********************************************************************************\n*           这里是代码：除非你知道你在做什么不然不要动它                       *\n********************************************************************************\n]]\n\n--#region Plugin Checks and Setting Init\n\nif not HasPlugin(\"vnavmesh\") then\n    yield(\"/echo [FATE] 请安装 vnavmesh\")\nend\n\nif not HasPlugin(\"BossMod\") and not HasPlugin(\"BossModReborn\") then\n    yield(\"/echo [FATE] 请安装一个AI躲避插件，无论是Veyn的BossMod还是BossMod Reborn\")\nend\n\nif not HasPlugin(\"TextAdvance\") then\n    yield(\"/echo [FATE] 请安装 TextAdvance\")\nend\n\nif EnableChangeInstance == true  then\n    if HasPlugin(\"Lifestream\") == false then\n        yield(\"/echo [FATE] 请安装 Lifestream 或在设置中禁用 ChangeInstance\")\n    end\nend\nif Retainers then\n    if not HasPlugin(\"AutoRetainer\") then\n        yield(\"/echo [FATE] 请安装 AutoRetainer\")\n    end\nend\nif ShouldGrandCompanyTurnIn then\n    if not HasPlugin(\"Deliveroo\") then\n        ShouldGrandCompanyTurnIn = false\n        yield(\"/echo [FATE] 请安装 Deliveroo\")\n    end\nend\nif ShouldExtractMateria then\n    if HasPlugin(\"YesAlready\") == false then\n        yield(\"/echo [FATE] 请安装 YesAlready\")\n    end\nend\nif DodgingPlugin == \"None\" then\n    -- do nothing\nelseif RotationPlugin == \"BMR\" and DodgingPlugin ~= \"BMR\" then\n    DodgingPlugin = \"BMR\"\nelseif RotationPlugin == \"VBM\" and DodgingPlugin ~= \"VBM\"  then\n    DodgingPlugin = \"VBM\"\nend\n\nyield(\"/at y\")\n\n--snd property\nfunction setSNDProperty(propertyName, value)\n    local currentValue = GetSNDProperty(propertyName)\n    if currentValue ~= value then\n        SetSNDProperty(propertyName, tostring(value))\n        LogInfo(\"[SetSNDProperty] \" .. propertyName .. \" set to \" .. tostring(value))\n    end\nend\n\nsetSNDProperty(\"UseItemStructsVersion\", true)\nsetSNDProperty(\"UseSNDTargeting\", true)\nsetSNDProperty(\"StopMacroIfTargetNotFound\", false)\nsetSNDProperty(\"StopMacroIfCantUseItem\", false)\nsetSNDProperty(\"StopMacroIfItemNotFound\", false)\nsetSNDProperty(\"StopMacroIfAddonNotFound\", false)\nsetSNDProperty(\"StopMacroIfAddonNotVisible\", false)\n\n--#endregion Plugin Checks and Setting Init\n\n--#region Data\n\nCharacterCondition = {\n    dead=2,\n    mounted=4,\n    inCombat=26,\n    casting=27,\n    occupiedInEvent=31,\n    occupiedInQuestEvent=32,\n    occupied=33,\n    boundByDuty34=34,\n    occupiedMateriaExtractionAndRepair=39,\n    betweenAreas=45,\n    jumping48=48,\n    jumping61=61,\n    occupiedSummoningBell=50,\n    betweenAreasForDuty=51,\n    boundByDuty56=56,\n    mounting57=57,\n    mounting64=64,\n    beingMoved=70,\n    flying=77\n}\n\nClassList =\n{\n    gla = { classId=1,  className=\"剑术师\",   isMelee=true,  isTank=true  },\n    pgl = { classId=2,  className=\"格斗家\",   isMelee=true,  isTank=false },\n    mrd = { classId=3,  className=\"斧术师\",   isMelee=true,  isTank=true  },\n    lnc = { classId=4,  className=\"枪术师\",   isMelee=true,  isTank=false },\n    arc = { classId=5,  className=\"弓箭手\",   isMelee=false, isTank=false },\n    cnj = { classId=6,  className=\"幻术师\",   isMelee=false, isTank=false },\n    thm = { classId=7,  className=\"咒术师\",   isMelee=false, isTank=false },\n    pld = { classId=19, className=\"骑士\", isMelee=true, isTank=true },\n    mnk = { classId=20, className=\"武僧\", isMelee=true, isTank=false },\n    war = { classId=21, className=\"战士\", isMelee=true, isTank=true },\n    drg = { classId=22, className=\"龙骑士\", isMelee=true, isTank=false },\n    brd = { classId=23, className=\"吟游诗人\", isMelee=false, isTank=false },\n    whm = { classId=24, className=\"白魔法师\", isMelee=false, isTank=false },\n    blm = { classId=25, className=\"黑魔法师\", isMelee=false, isTank=false },\n    acn = { classId=26, className=\"秘术师\",   isMelee=false, isTank=false },\n    smn = { classId=27, className=\"召唤师\",   isMelee=false, isTank=false },\n    sch = { classId=28, className=\"学者\",     isMelee=false, isTank=false },\n    rog = { classId=29, className=\"双剑师\",   isMelee=false, isTank=false },\n    nin = { classId=30, className=\"忍者\", isMelee=true, isTank=false },\n    mch = { classId=31, className=\"机工士\", isMelee=false, isTank=false},\n    drk = { classId=32, className=\"暗黑骑士\", isMelee=true, isTank=true },\n    ast = { classId=33, className=\"占星术士\", isMelee=false, isTank=false },\n    sam = { classId=34, className=\"武士\", isMelee=true, isTank=false },\n    rdm = { classId=35, className=\"赤魔法师\", isMelee=false, isTank=false },\n    blu = { classId=36, className=\"青魔法师\", isMelee=false, isTank=false },\n    gnb = { classId=37, className=\"绝枪战士\", isMelee=true, isTank=true },\n    dnc = { classId=38, className=\"舞者\", isMelee=false, isTank=false },\n    rpr = { classId=39, className=\"钐镰客\", isMelee=true, isTank=false },\n    sge = { classId=40, className=\"贤者\", isMelee=false, isTank=false },\n    vpr = { classId=41, className=\"蝰蛇剑士\", isMelee=true, isTank=false },\n    pct = { classId=42, className=\"绘灵法师\", isMelee=false, isTank=false }\n}\n\nBicolorExchangeData =\n{\n    {\n        shopKeepName = \"广域交易商 加德弗里德\",\n        zoneName = \"旧萨雷安\",\n        zoneId = 962,\n        aetheryteName = \"旧萨雷安\",\n        x=78, y=5, z=-37,\n        shopItems =\n        {\n            { itemName = \"双色宝石的收据\", itemIndex = 8, price = 100 },\n            { itemName = \"麝牛奶\", itemIndex = 9, price = 2 },\n            { itemName = \"桓娑鸟胸肉\", itemIndex = 10, price = 2 },\n            { itemName = \"亚考牛肩肉\", itemIndex = 11, price = 2 },\n            { itemName = \"厄尔庇斯之鸟胸肉\", itemIndex = 12, price = 2 },\n            { itemName = \"厄尔庇斯之鸟蛋\", itemIndex = 13, price = 2 },\n            { itemName = \"庵摩罗果\", itemIndex = 14, price = 2 },\n            { itemName = \"潜能量碎晶\", itemIndex = 15, price = 2 },\n            { itemName = \"阿尔马斯提毛发\", itemIndex = 16, price = 2 },\n            { itemName = \"伽迦象的粗皮\", itemIndex = 17, price = 2 },\n            { itemName = \"山鸡的粗皮\", itemIndex = 18, price = 2 },\n            { itemName = \"赛加羚羊的粗皮\", itemIndex = 19, price = 2 },\n            { itemName = \"金毗罗鳄的粗皮\", itemIndex = 20, price = 2 },\n            { itemName = \"蛇牛的粗皮\", itemIndex = 21, price = 2 },\n            { itemName = \"贝尔卡楠的树液\", itemIndex = 22, price = 2 },\n            { itemName = \"炸药怪的灰\", itemIndex = 23, price = 2 },\n            { itemName = \"月面仙人刺的花\", itemIndex = 24, price = 2 },\n            { itemName = \"慕斯怪的肉\", itemIndex = 25, price = 2 },\n            { itemName = \"彩蝶鳞粉\", itemIndex = 26, price = 2 },\n        }\n    },\n    {\n        shopKeepName = \"广域交易商 贝瑞尔\",\n        zoneName = \"九号解决方案\",\n        zoneId = 1186,\n        aetheryteName = \"九号解决方案\",\n        x=-198.47, y=0.92, z=-6.95,\n        miniAethernet = {\n            name = \"联合商城\",\n            x=-157.74, y=0.29, z=17.43\n        },\n        shopItems =\n        {\n            { itemName = \"图拉尔双色宝石的收据\", itemIndex = 6, price = 100 },\n            { itemName = \"羊驼的里脊肉\", itemIndex = 7, price = 3 },\n            { itemName = \"沼泽鬼鱼的腿肉\", itemIndex = 8, price = 3 },\n            { itemName = \"犎牛肩肉\", itemIndex = 9, price = 3 },\n            { itemName = \"巨龙舌兰的球茎\", itemIndex = 10, price = 3 },\n            { itemName = \"拟鸟枝的果实\", itemIndex = 11, price = 3 },\n            { itemName = \"圆扇刺梨\", itemIndex = 12, price = 3 },\n            { itemName = \"犎牛兽毛\", itemIndex = 13, price = 3 },\n            { itemName = \"奥阔银狼的粗皮\", itemIndex = 14, price = 3 },\n            { itemName = \"锤头鳄的粗皮\", itemIndex = 15, price = 3 },\n            { itemName = \"狞豹的粗皮\", itemIndex = 16, price = 3 },\n            { itemName = \"嵌齿象的粗皮\", itemIndex = 17, price = 3 },\n            { itemName = \"卡冈图亚的粗皮\", itemIndex = 18, price = 3 },\n            { itemName = \"小鸣鼠的刃爪\", itemIndex = 19, price = 3 },\n            { itemName = \"毒蛙的粘液\", itemIndex = 20, price = 3 },\n            { itemName = \"斧喙魔鸟的翼膜\", itemIndex = 21, price = 3 },\n            { itemName = \"小亚波伦的甲壳\", itemIndex = 22, price = 3 },\n            { itemName = \"风滚蟹的枯草\", itemIndex = 23, price = 3 },\n        }\n    }\n}\n\nFatesData = {\n    {\n        zoneName = \"中拉诺西亚\",\n        zoneId = 134,\n        fatesList = {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"无穷无尽的打地鼠\" , npcName=\"一筹莫展的农夫\" },\n                { fateName=\"实战巡礼\", npcName=\"黄衫队训练教官\"},\n                { fateName=\"鼠害的小聪明\", npcName=\"求助的农夫\" }, --防御\n                { fateName=\"德内维尔关防卫训练\", npcName=\"魔鬼漩士 杜恩法尔\"} --防御\n            },\n            fatesWithContinuations = {\n                { fateName=\"追逐\", continuationIsBoss=true }\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"拉诺西亚低地\",\n        zoneId = 135,\n        fatesList = {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"花丛噩梦\" , npcName=\"愤怒的农夫\" },\n                { fateName=\"小麦粉战争\" , npcName=\"求助的风车管理人\" },\n                { fateName=\"海盗的方式\" , npcName=\"黄衫队陆战兵\" },\n                { fateName=\"麻烦人生——偷渡者阿科特修提姆\", npcName=\"熟练的警备兵\" }  --防御\n            },\n            fatesWithContinuations = {\n                { fateName=\"雪松原之战\", continuationIsBoss=true }\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"西拉诺西亚\",\n        zoneId = 138,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"海关的强制搜查\", npcName=\"黄衫队陆尉\" }\n            },\n            otherNpcFates= {\n                { fateName=\"支援补给线\", npcName=\"黑涡团运输兵\" },\n                { fateName=\"蔬菜革命——蔓德拉战队\", npcName=\"希尔迪布兰德\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"北防波堤之战 侦察行动\", continuationIsBoss=true },\n                { fateName=\"南防波堤之战 侦察行动\", continuationIsBoss=true }\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"拉诺西亚高地\",\n        zoneId = 139,\n        fatesList = {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"不幸的佣兵——美男子布迦加\", npcName=\"黑涡团副漩士\"}\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"西萨纳兰\",\n        zoneId = 140,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"土之核心\", npcName=\"热心工作的工人\" }\n            },\n            otherNpcFates= {\n                { fateName=\"阶级愤怒的铁锤\", npcName=\"束手无策的工人\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {\n                \"荒野的保镖\", --呃呃，自动寻路不喜欢这样的傻逼大桥\n                \"护送负伤者\" --护送类\n            }\n        },\n        flying=false --别问 问就是傻缺地平关大升降梯\n    },\n    {\n        zoneName = \"中萨纳兰\",\n        zoneId = 141,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"营养丰富的仙人掌\", npcName=\"饥饿的少女\"},\n                { fateName=\"屈伊伯龙家的人\" , npcName=\"无计可施的商人\" }\n            },\n            otherNpcFates= {\n                { fateName=\"深不见底——酒豪谷谷卢恩\", npcName=\"金库灵柩亭的保镖\" },\n                { fateName=\"粗野的赌徒——无赖格里希尔德\", npcName=\"失败的冒险者\" },\n                { fateName=\"杀人鱼的末日\", npcName=\"少年克里斯\"} \n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {\n                -- \"守住晚饭\" --地形疑似自动寻路过不去\n            }\n        },\n        flying=false --垃圾se\n    },\n    {\n        zoneName = \"东萨纳兰\",\n        zoneId = 145,\n        fatesList = {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"跨天桥上的死斗 市民营救战\" , npcName=\"铜刃团卫兵\" }, --前置fate失败才会出现\n                { fateName=\"阻止敌人的侵略\", npcName=\"恒辉队侦察兵\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"跨天桥上的死斗 前哨战\", continuationIsBoss=false },\n                { fateName=\"跨天桥上的死斗 守卫战\", continuationIsBoss=true }, --需要前哨战成功\n                -- { fateName=\"跨天桥上的死斗 迎击兹兹卢恩\", continuationIsBoss=true }  --需要守卫战成功\n            },\n            specialFates = {\n                \"死亡的假面——黄道巨蟹\"\n            },\n            blacklistedFates= {\n                \"阻止敌人的侵略\" --近战只有卡住的命，而且又是鸟巢类     \n            }\n        }\n    },\n    {\n        zoneName = \"南萨纳兰\",\n        zoneId = 146,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"解开真理\", npcName=\"古代魔法研究者\" }\n            },\n            otherNpcFates= {\n                { fateName=\"荒野灭火\", npcName=\"恒辉队兵卒\" },\n                { fateName=\"怒涛怪力——金刚爪奈寨德·夏\", npcName=\"恒辉队侦察兵\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"无法无天——破戒者吉斯弗里德\", continuationIsBoss=true },\n                { fateName=\"沙漠之子\", continuationIsBoss=false } -- 后续：沙漠皇帝——乌尔哈德希\n            },\n            blacklistedFates= {\n                \"侦察兵的工作\", --护送\n                \"工艺神的守护者\", --护送\n                \"猎人与猎物\", --vnav无法寻路？？\n                \"沙漠皇帝——乌尔哈德希\" --BOSS出现后打小怪没进度的，小怪无限刷\n\n                -- BAN了不悔战阵的fate 自由飞吧\n                --\"蜥蜴人军特殊部队——炎牙众\",\n                --\"速射名手——白火花哈普古·秋\",\n                --\"第一关门攻略战\",\n                --\"火神的召唤者——流火印阿法基·天\"\n            }\n        },\n        flying = false -- SE 加点地图飞行高度上限吧 求你了\n    },\n    {\n        zoneName = \"黑衣森林中央林区\",\n        zoneId = 148,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"以毒攻毒\", npcName=\"鬼哭队队员\" },\n                { fateName=\"寻求真理\", npcName=\"不知名的法师\" }\n            },\n            otherNpcFates= {\n            },\n            fatesWithContinuations = {},\n            specialFates = {\n                \"上古斗神——奥丁\" -- 2.0特殊fate！\n            },\n            blacklistedFates= {\n                \"愤怒的教官——狂人米罗东\", --护送\n                \"谨记地母神之所忘\" --窄桥…… \n            }\n        }\n    },\n    {\n        zoneName = \"黑衣森林东部林区\",\n        zoneId = 152,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"昔日之光\", npcName=\"新叶 法纳克希奥\"}\n            },\n            otherNpcFates= {\n            },\n            fatesWithContinuations = {\n                { fateName=\"百灵啼遭遇战\", continuationIsBoss=false }\n            },\n            specialFates = {\n                \"上古斗神——奥丁\", -- 2.0特殊fate！\n                \"无情的收割者——懒惰口花劳伦斯\"\n            },\n            blacklistedFates= {\n                \"祝福的佳酿\" --护送\n            }\n        }\n    },\n    {\n        zoneName = \"黑衣森林北部林区\",\n        zoneId = 154,\n        fatesList = {\n            collectionsFates= {\n                { fateName=\"山人的心愿\", npcName=\"形迹可疑的开山工\" }\n            },\n            otherNpcFates= {\n            },\n            fatesWithContinuations = {},\n            specialFates = {\n                \"上古斗神——奥丁\" -- 2.0特殊fate！\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"拉诺西亚外地\",\n        zoneId = 180,\n        fatesList = {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"营救补给部队\", npcName=\"无助的车夫\" },\n                { fateName=\"试掘地强攻\", npcName=\"黑涡团二等漩兵\" }\n            },\n            fatesWithContinuations = {\n                -- { fateName=\"妖异杀手——第59团巡逻员凯伽\", continuationIsBoss=true },\n                -- { fateName=\"钢之炼金术士\", continuationIsBoss=true }\n                -- 隔着好远呢 当不存在吧\n            },\n            blacklistedFates= {\n                \"试掘地强攻\" --SE能不能少做点打鸟巢系的fate\n            }\n        },\n        flying = false --这个傻逼地灵族矿山 妈的SE\n    },\n    {\n        zoneName = \"库尔札斯中央高地\",\n        zoneId = 155,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"圣人的泪水\", npcName=\"库尔札斯的商人\" },\n            },\n            otherNpcFates= {\n                { fateName=\"斯瓦拉的袭击\", npcName=\"福尔唐家的工兵\" },\n                { fateName=\"巨人谜语\", npcName=\"福尔唐家的卫兵\" },\n                { fateName=\"力量之塔\", npcName=\"艾因哈特家的卫兵\"}\n            },\n            fatesWithContinuations = {\n                -- { fateName=\"斯瓦拉的袭击\", continuationIsBoss=false },\n                { fateName=\"斯瓦拉的恐怖\", continuationIsBoss=true }\n            },\n            specialFates = {\n                \"传说的魔兽——贝希摩斯\",\n                \"受伤的魔兽——贝希摩斯\",\n                \"归来的复仇者——史特罗佩斯\"\n            },\n            blacklistedFates= {\n                \"满天星光\" --护送\n                --\"斯瓦拉的袭击\" --护送\n            }\n        }\n    },\n    {\n        zoneName = \"库尔札斯西部高地\",\n        zoneId = 397,\n        fatesList= {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"年轻龙骑士——阿莱姆贝\", npcName=\"圣菲内雅连队的骑兵\" },\n                { fateName=\"功绩掠夺者——卑鄙的维尔纳\", npcName=\"直率的博多内\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"白雪茫茫\", continuationIsBoss=true },\n                { fateName=\"黑铁桥之战\", continuationIsBoss=true },\n                { fateName=\"讨伐龙之眷属\", continuationIsBoss=true },\n                { fateName=\"年轻龙骑士——阿莱姆贝\", continuationIsBoss=true }\n            },\n            specialFates = {\n                \"吞噬牦牛的巨人——巨脚雪人\", -- 太硬了！！！\n            },\n            blacklistedFates= {\n                \"注意冰面\" --注意被栅栏挡住的你（哭）\n            }\n        }\n    },\n    {\n        zoneName = \"摩杜纳\",\n        zoneId = 156,\n        fatesList= {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"昔日不在\", npcName=\"经验丰富的冒险者\" },\n                { fateName=\"圣地巡礼\", npcName=\"圣寇伊纳克财团的搬运工\" },\n                { fateName=\"旅伴\", npcName=\"体型强健的调查员\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {\n                \"旅伴\" --护送\n            }\n        }\n    },\n    {\n        zoneName = \"阿巴拉提亚云海\",\n        zoneId = 401,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"天空之云\", npcName=\"年轻的尊杜人 \" } \n            },\n            otherNpcFates= {\n                { fateName=\"逃亡者\", npcName=\"逃亡的尊杜奴隶\" }, --护送\n                { fateName=\"突飞猛进\", npcName=\"云顶蔷薇骑兵\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"冠恐鸟窝破坏命令\", continuationIsBoss=true },\n                { fateName=\"云神祭司——凯那瓦努\", continuationIsBoss=false },\n                { fateName=\"凯那瓦努的弟子们\", continuationIsBoss=true }\n            },\n            specialFates = {\n                \"暴食人形岩——大地饕餮\" -- 很硬\n            },\n            blacklistedFates= {\n                \"冠恐鸟窝破坏命令\", --打鸟巢才算有效进度，一直打渡渡鸟没用\n                \"逃亡者\" --护送\n            }\n        }\n    },\n    {\n        zoneName = \"魔大陆阿济兹拉\",\n        zoneId = 402,\n        fatesList= {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"错误报告199号\", npcName=\"检查系统\" }\n            },\n            fatesWithContinuations = {\n                { fateName= \"全自动手工业\", continuationIsBoss=true }\n            },\n            specialFates = {\n                \"太古威胁 夜光花歼灭战\" --3.0特殊fate\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"龙堡参天高地\",\n        zoneId = 398,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"不灭之箭\", npcName=\"尾羽集落的猎人\" }\n            },\n            otherNpcFates= {\n                { fateName=\"芳香四溢\", npcName=\"散发醇香的莫西·匹克\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"敌人的敌人还是敌人\", continuationIsBoss=true }\n                -- { fateName=\"雷兽女王——长须豹女王\", continuationIsBoss=true },\n                -- { fateName=\"逆袭女王——长须豹女王\", continuationIsBoss=true }\n            },\n            specialFates = {\n                \"坚甲铁龙——塔拉斯克\", -- 很硬\n                \"雷兽女王——长须豹女王\",\n                \"逆袭女王——长须豹女王\",\n                \"幻影女王——长须豹女王\"\n            },\n            blacklistedFates= {\n                \"鲑鱼战争\" --地形原因 近战容易卡住...\n            }\n        }\n    },\n    {\n        zoneName = \"龙堡内陆低地\",\n        zoneId=399,\n        tpZoneId = 478,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"恶魔机器\", npcName=\"多面玲珑 斯里克崔克斯\" },\n                { fateName=\"珍惜古书\", npcName=\"视书如命 布罗菲克斯\" }\n            },\n            otherNpcFates= {\n                { fateName=\"使魔不好当\", npcName=\"马洛·罗格\" }\n            },\n            fatesWithContinuations = {\n                -- { fateName=\"恶魔机器\", continuationIsBoss=false },\n                { fateName=\"复仇者们\", continuationIsBoss=true },\n                { fateName=\"哥布林纷争\", continuationIsBoss=true }\n            },\n            specialFates = {\n                \"淋血暴君——天枢巨熊\",\n                \"全面改造机——3号哥布林装甲J型\"\n            },\n            blacklistedFates= {\n                \"使魔不好当\" --护送\n            }\n        }\n    },\n    {\n        zoneName = \"翻云雾海\",\n        zoneId=400,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"莫古力赚钱之道\", npcName=\"追求时尚的莫古力\" }\n            },\n            otherNpcFates= {\n                { fateName=\"永不衰退的吸引力\", npcName=\"滔滔不绝的莫古力\" }, -- 护送\n                { fateName=\"古恐龙再见\", npcName=\"小顽童 莫古希\" },\n                { fateName=\"云海小顽童——莫古希\", npcName=\"优等生 莫古珀\" },\n                { fateName=\"天极白垩宫防卫战 救助幼龙\", npcName=\"天极幼龙\" },\n                { fateName=\"夜与雾\", npcName=\"法亚拉\" },\n                { fateName=\"圣与邪的扭曲\", npcName=\"天极幼龙\" }\n            },\n            fatesWithContinuations = {\n                { fateName=\"与龙共舞\", continuationIsBoss=false },\n                { fateName=\"火尾飞蜥大军\", continuationIsBoss=false },\n                { fateName=\"暗鳞黑龙征讨战 白龙支援\" , continuationIsBoss=false }\n                -- { fateName=\"暗鳞黑龙征讨战 追击作战\" , continuationIsBoss=false }\n            },\n            specialFates = {\n                \"苍天白龙——维德佛尔尼尔\" --纯纯挂机我猜也触发不了的 大概\n            },\n            blacklistedFates= {\n                \"暗鳞黑龙征讨战 白龙支援\",  -- 太硬了！一个人实在打不动\n                \"天极白垩宫防卫战 救助莫古\", --比较硬，但是有治疗战术鸟奶你的话也不是打不死\n                \"永不衰退的吸引力\" --别护送了！\n            }\n        }\n    },\n    {\n        zoneName = \"基拉巴尼亚边区\",\n        zoneId = 612,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"集中训练营 士兵之章\", npcName=\"弗雷拉克·巴尔本辛协漩校\" },\n                { fateName=\"新石器时代\", npcName=\"梅氏的少女\" },\n            },\n            otherNpcFates= {\n                { fateName=\"冥河世界\", npcName=\"黑涡团传令员\" },\n                { fateName=\"蚁狮没有攻击性\", npcName=\"梅氏的猎人\" },\n                { fateName=\"下个岩石继续\", npcName=\"阿拉米格解放军战士\" },\n                { fateName=\"边境巡视员\", npcName=\"阿拉米格解放军战士\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"基拉巴尼亚山区\",\n        zoneId = 620,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"狮鹫物语\", npcName=\"流浪的酒保商人\" }\n            },\n            otherNpcFates= {\n                { fateName=\"勇敢的蚱蜢\", npcName=\"受伤的战士\" },\n                { fateName=\"生死关头\", npcName=\"阿拉加纳的居民\" },\n                { fateName=\"等好久了！\", npcName=\"寒炉村居民\" },\n                { fateName=\"血的收获\", npcName=\"倔强的农夫\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {\n                \"失控的最终兵器——致命武器\", --escort\n                \"素食主义者\" --escort\n            }\n        }\n    },\n    {\n        zoneName = \"基拉巴尼亚湖区\",\n        zoneId = 621,\n        fatesList= {\n            collectionsFates= {},\n            otherNpcFates= {},\n            fatesWithContinuations = {},\n            specialFates = {\n                \"传说中的雷马——伊克西翁\" --雷马\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"红玉海\",\n        zoneId = 613,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"红甲族千两首\", npcName=\"被打劫的碧甲族\" },\n                { fateName=\"红色珊瑚礁\", npcName=\"稳重的海盗\" }\n            },\n            otherNpcFates= {\n                { fateName=\"兵法修行者——一刀客千万\", npcName=\"海贼众的少女\" },\n                { fateName=\"红甲族恣意的风筝\", npcName=\"负伤的海盗\" },\n                { fateName=\"无礼的牛鬼——尘轮鬼\", npcName=\"十分困扰的海盗\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"延夏\",\n        zoneId = 614,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"稻生物怪录\", npcName=\"束手无策的农妇\" },\n                { fateName=\"银狐的心愿\", npcName=\"银狐\" }\n            },\n            otherNpcFates= {\n                { fateName=\"金狐的心愿\", npcName=\"金狐\" },\n                { fateName=\"倒霉的鱼群\", npcName=\"大鱼丰收 鱼群\" }\n            },\n            specialFates = {\n                \"九尾妖狐——玉藻御前\" --玉藻前\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"太阳神草原\",\n        zoneId = 622,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"答塔克的旅程之挤羊奶\", npcName=\"阿儿塔尼\" }\n            },\n            otherNpcFates= {\n                { fateName=\"忏悔\", npcName=\"奥罗尼部年轻人\" },\n                { fateName=\"归家路上的放牛少女\", npcName=\"奥儿昆德部牛倌\" },\n                { fateName=\"转瞬的噩梦\", npcName=\"模儿部羊倌\" },\n                { fateName=\"沉默的制裁\", npcName=\"凯苏提尔部商人\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"雷克兰德\",\n        zoneId = 813,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"樵夫之歌\", npcName=\"雷克兰德的樵夫\" }\n            },\n            otherNpcFates= {\n                { fateName=\"与紫叶团的战斗之卑鄙陷阱\", npcName=\"像是旅行商人的男子\" }, --24 防御\n                { fateName=\"污秽之血\", npcName=\"乔布要塞的卫兵\" } --24 防御\n            },\n            fatesWithContinuations = {\n                \"高度进化\"\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"珂露西亚岛\",\n        zoneId = 814,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"制作战士之自走人偶\", npcName=\"图尔家族的技师\" }\n            },\n            otherNpcFates= {},\n            fatesWithContinuations = {},\n            specialFates = {\n                \"激斗畏惧装甲之秘密武器\" -- 畏惧装甲（特殊FATE）\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"安穆·艾兰\",\n        zoneId = 815,\n        fatesList= {\n            collectionsFates= {},\n            otherNpcFates= {},\n            fatesWithContinuations = {},\n            blacklistedFates= {\n                \"托尔巴龟最棒\" -- 去的的路上难打\n            }\n        }\n    },\n    {\n        zoneName = \"伊尔美格\",\n        zoneId = 816,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"仙子尾巴之金黄花蜜\", npcName=\"寻找花蜜的仙子\" }\n            },\n            otherNpcFates= {\n                { fateName=\"仙子尾巴之魔物包围网\", npcName=\"寻找花蜜的仙子\" }\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"拉凯提卡大森林\",\n        zoneId = 817,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"粉红鹳\", npcName=\"夜之民导师\" },\n                { fateName=\"缅楠的巡逻之补充弓箭\", npcName=\"散弓音 缅楠\" },\n                { fateName=\"传说诞生\", npcName=\"法诺的看守\" }\n            },\n            otherNpcFates= {\n                { fateName=\"吉梅与萨梅\", npcName=\"血红枪 吉梅\" }, --24 防御\n                { fateName=\"死相陆鸟——刻莱诺\", npcName=\"法诺的猎人\" } --22 boss\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"黑风海\",\n        zoneId = 818,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"灾厄的古塔尼亚之收集红血珊瑚\", npcName=\"提乌嘶·澳恩\" },\n                { fateName=\"珍珠永恒\", npcName=\"鳍人族捕鱼人\" }\n            },\n            otherNpcFates= {\n                { fateName=\"灾厄的古塔尼亚之开始追踪\", npcName=\"提乌嘶·澳恩\" }, --23 一般\n                { fateName=\"灾厄的古塔尼亚之兹姆嘶登场\", npcName=\"提乌嘶·澳恩\" }, --23 一般\n                { fateName=\"灾厄的古塔尼亚之保护提乌嘶\", npcName=\"提乌嘶·澳恩\" }, --24 防御\n                { fateName=\"灾厄的古塔尼亚之护卫提乌嘶\", npcName=\"提乌嘶·澳恩\" }, --护送\n                { fateName=\"灾厄的古塔尼亚之准备决战\", npcName=\"提乌嘶·澳恩\" } --24 防御\n            },\n            fatesWithContinuations = {},\n            specialFates = {\n                \"灾厄的古塔尼亚之深海讨伐战\" -- 古塔尼亚（特殊FATE）\n            },\n            blacklistedFates= {\n                \"贝汁物语\", --护送\n                \"灾厄的古塔尼亚之护卫提乌嘶\" --护送\n            }\n        }\n    },\n    {\n        zoneName = \"迷津\",\n        zoneId = 956,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"迷津风玫瑰\", npcName=\"束手无策的研究员\" },\n                { fateName=\"纯天然保湿护肤品\", npcName=\"皮肤很好的研究员\" }\n            },\n            otherNpcFates= {\n                { fateName=\"牧羊人的日常\", npcName=\"种畜研究所的驯兽人\" } --24 タワーディフェンス\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"萨维奈岛\",\n        zoneId = 957,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"芳香的炼金术士：危险的芬芳\", npcName=\"调香师 萨加巴缇\" }\n            },\n            otherNpcFates= {\n               { fateName=\"猴子军团\", npcName=\"采草药的女孩\" },\n               { fateName=\"少年与海\", npcName=\"渔夫的儿子\" } --24 防御\n            },\n            fatesWithContinuations = {},\n            specialFates = {\n                \"兽道诸神信仰：伪神降临\" -- 兽道神明灯天王（特殊FATE）\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"加雷马\",\n        zoneId = 958,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"资源回收分秒必争\", npcName=\"沦为难民的魔导技师\" }\n            },\n            otherNpcFates= {\n                { fateName=\"魔导技师的归乡之旅：启程\", npcName=\"柯尔特隆纳协漩尉\" }, --22 boss\n                { fateName=\"魔导技师的归乡之旅：落入陷阱\", npcName=\"埃布雷尔诺\" }, --24 防御\n                { fateName=\"魔导技师的归乡之旅：实弹射击\", npcName=\"柯尔特隆纳协漩尉\" }, --23 一般\n                { fateName=\"雪原的巨魔\", npcName=\"幸存的难民\" } --24 防御\n            },\n            fatesWithContinuations = {\n                { fateName=\"魔导技师的归乡之旅：指挥机梅塔特隆\", continuationIsBoss=true }\n            },\n            blacklistedFates= {\n\"魔导技师的归乡之旅：启程\"\n}\n        }\n    },\n    {\n        zoneName = \"叹息海\",\n        zoneId = 959,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"如何追求兔生刺激\", npcName=\"担惊威\" }\n            },\n            otherNpcFates= {\n                { fateName=\"叹息的白兔之轰隆隆大爆炸\", npcName=\"战兵威\" }, --24 タワーディフェンス\n                { fateName=\"叹息的白兔之乱糟糟大失控\", npcName=\"落名威\" }, --23 通常\n                { fateName=\"叹息的白兔之怒冲冲大处理\", npcName=\"落名威\" } --22 ボス\n            },\n            fatesWithContinuations = {},\n            blacklistedFates= {\n                \"跨海而来的老饕\", --由于斜坡上视野不佳，可能什么都做不了就呆站着\n            }\n        }\n    },\n    {\n        zoneName = \"天外天垓\",\n        zoneId = 960,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"侵略兵器召回指令：扩建通信设备\", npcName=\"N-6205\" }\n            },\n            otherNpcFates= {\n                { fateName=\"荣光之翼——阿尔·艾因\", npcName=\"阿尔·艾因的朋友\" }, --22 boss\n                { fateName=\"侵略兵器召回指令：保护N-6205\", npcName=\"N-6205\"}, --24 防御\n                { fateName=\"走向永恒的结局\", npcName=\"米克·涅尔\" } --24 防御\n            },\n            fatesWithContinuations = {},\n            specialFates = {\n                \"侵略兵器召回指令：破坏侵略兵器希\" -- 希（特殊FATE）\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"厄尔庇斯\",\n        zoneId = 961,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"望请索克勒斯先生谅解\", npcName=\"负责植物的观察者\" }\n            },\n            otherNpcFates= {\n                { fateName=\"创造计划：过于新颖的理念\", npcName=\"神秘莫测 莫勒图斯\" }, --23 一般\n                { fateName=\"创造计划：伊娥观察任务\", npcName=\"神秘莫测 莫勒图斯\" }, --23 一般\n                { fateName=\"告死鸟\", npcName=\"一角兽的观察者\" }, --24 防御\n            },\n            fatesWithContinuations = {\n                { fateName=\"创造计划：过于新颖的理念\", continuationIsBoss=true },\n                { fateName=\"创造计划：伊娥观察任务\", continuationIsBoss=true }\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName = \"奥阔帕恰山\",\n        zoneId = 1187,\n        fatesList= {\n            collectionsFates= {},\n            otherNpcFates= {\n                { fateName=\"牧场关门\", npcName=\"健步如飞 基维利\" }, --23 一般\n                { fateName=\"跃动的火热——山火\", npcName=\"健步如飞 基维利\" }, --22 boss\n                { fateName=\"不死之人\", npcName=\"扫墓的尤卡巨人\" }, --23 一般\n                { fateName=\"失落的山顶都城\", npcName=\"守护遗迹的尤卡巨人\" }, --24 防御\n                { fateName=\"咖啡豆岌岌可危\", npcName=\"咖啡农园的工作人员\" }, --24 防御\n                { fateName=\"千年孤独\", npcName=\"其瓦固佩刀者\" }, --23 一般\n                { fateName=\"飞天魔厨——佩鲁的天敌\", npcName=\"佩鲁佩鲁的旅行商人\" }, --22 boss\n                { fateName=\"狼之家族\", npcName=\"佩鲁佩鲁族旅行商人\" }  --23 一般\n            },\n            fatesWithContinuations = {\n                { fateName=\"不死之人\", continuationIsBoss=true },\n                { fateName=\"千年孤独\", continuationIsBoss=true }\n            },\n            blacklistedFates= {\n                --\"只有爆炸\", -- 不知道为什么过不去（测试2天未发现问题，给注释了）\n                --\"狼之家族\", -- 存在多个 佩鲁佩鲁族旅行商人 npc，能否与正确npc交互开始FATE存在随机性，除非使用dr可以取消这条黑名单（佩鲁佩鲁的旅行商人）\n                --\"飞天魔厨——佩鲁的天敌\", -- 存在多个 佩鲁佩鲁族旅行商人 npc，除非使用dr可以取消这条黑名单（佩鲁佩鲁的旅行商人）\n                \"跃动的火热——山火\" -- FATE周围有石头挡着，AI 躲避会日墙无限抽搐\n            }\n        }\n    },\n    {\n        zoneName=\"克扎玛乌卡湿地\",\n        zoneId=1188,\n        fatesList={\n            collectionsFates={\n                { fateName=\"密林淘金\", npcName=\"莫布林族采集者\" },\n                { fateName=\"巧若天工\", npcName=\"哈努族手艺人\" },\n                \n            },\n            otherNpcFates= {\n                { fateName=\"怪力大肚王——非凡飔戮龙\", npcName=\"哈努族捕鱼人\" }, --22 boss\n                { fateName=\"芦苇荡的时光\", npcName=\"哈努族农夫\" }, --23 一般\n                { fateName=\"贡品小偷\", npcName=\"哈努族巫女\" }, --24 防御\n                { fateName=\"横征暴敛？\", npcName=\"佩鲁佩鲁族商人\" }, --24 防御\n                { fateName=\"美丽菇世界\", npcName=\"贴心巧匠 巴诺布罗坷\" }  --23 一般\n            },\n            fatesWithContinuations = {\n                { fateName=\"美丽菇世界\", continuationIsBoss=true }\n            },\n            blacklistedFates= {\n                --\"横征暴敛？\" -- 存在多个 佩鲁佩鲁族旅行商人 npc，除非使用dr可以取消这条黑名单（佩鲁佩鲁的旅行商人）\n                \"密林淘金\" --地形很糟糕\n            }\n        }\n    },\n    {\n        zoneName=\"亚克特尔树海\",\n        zoneId=1189,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"逃离恐怖菇\", npcName=\"霍比格族采集者\" }\n            },\n            otherNpcFates= {\n                { fateName=\"顶击大貒猪\", npcName=\"灵豹之民猎人\" }, --23 一般\n                { fateName=\"血染利爪——米尤鲁尔\", npcName=\"灵豹之民猎人\" }, --22 boss\n                { fateName=\"致命螳螂\", npcName=\"灵豹之民猎人\" }, --23 一般\n                { fateName=\"辉鳞族不法之徒袭击事件\", npcName=\"朵普罗族枪手\" }, --23 一般\n                { fateName=\"守护秘药之战\", npcName=\"霍比格族运货人\" }  --24 防御\n            },\n            fatesWithContinuations = {\n                { fateName=\"顶击大貒猪\", continuationIsBoss=false },\n                { fateName=\"辉鳞族不法之徒袭击事件\", continuationIsBoss=true }\n            },\n            blacklistedFates= {\n                --\"顶击大貒猪\", -- 由于同一地点有多个同名NPC存在，除非使用dr可以取消这条黑名单\n                --\"血染利爪——米尤鲁尔\", -- 由于同一地点有多个同名NPC存在，除非使用dr可以取消这条黑名单\n                --\"致命螳螂\" -- 由于同一地点有多个同名NPC存在，除非使用dr可以取消这条黑名单\n               -- \"圣树邪魔——坏死花\" -- 测试中\n            }\n        }\n    },\n    {\n        zoneName=\"夏劳尼荒野\",\n        zoneId=1190,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"剃毛时间\", npcName=\"迎曦之民采集者\" },\n                { fateName=\"蛇王得酷热涅：狩猎前的准备\", npcName=\"夕阳尚红 布鲁克·瓦\" }\n            },\n            otherNpcFates= {\n                { fateName=\"死而复生的恶棍——阴魂不散 扎特夸\", npcName=\"迎曦之民劳动者\" }, --22 boss\n                { fateName=\"不甘的冲锋者——灰达奇\", npcName=\"崇灵之民男性\" }, --22 boss\n                { fateName=\"和牛一起旅行\", npcName=\"崇灵之民女性\" }, --23 一般\n                { fateName=\"大湖之恋\", npcName=\"崇灵之民渔夫\" }, --24 防御\n                { fateName=\"神秘翼龙荒野奇谈\", npcName=\"佩鲁佩鲁族旅行商人\" }  --23 一般\n            },\n            fatesWithContinuations = {\n                { fateName=\"蛇王得酷热涅：狩猎的杀手锏\", continuationIsBoss=false }\n            },\n            specialFates = {\n                \"蛇王得酷热涅：荒野的死斗\" -- 得酷热涅（特殊FATE）\n            },\n            blacklistedFates= {}\n        }\n    },\n    {\n        zoneName=\"遗产之地\",\n        zoneId=1191,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"药师的工作\", npcName=\"迎曦之民栽培者\" },\n                { fateName=\"亮闪闪的可回收资源\", npcName=\"英姿飒爽的再造者\" }\n            },\n            otherNpcFates= {\n                { fateName=\"机械迷城\", npcName=\"初出茅庐的狩猎者\" }, --23 一般\n                { fateName=\"你来我往\", npcName=\"初出茅庐的狩猎者\" }, --23 一般\n                { fateName=\"剥皮行者\", npcName=\"陷入危机的狩猎者\" }, --23 一般\n                { fateName=\"铭刻于灵魂中的恐惧\", npcName=\"终流地的再造者\" }, --23 一般\n                { fateName=\"机械公敌\", npcName=\"走投无路的再造者\" }, --23 一般\n                { fateName=\"前路多茫然\", npcName=\"害怕的运送者\" }  --23 一般\n            },\n            fatesWithContinuations = {\n                { fateName=\"机械公敌\", continuationIsBoss=false }\n            },\n            blacklistedFates= {\n                \"亮闪闪的可回收资源\", -- 地形很糟糕\n                \"铭刻于灵魂中的恐惧\", -- 无法导航\n                \"机械公敌\", -- 无法导航\n                \"print('I hate snakes')\"\n            }\n        }\n    },\n    {\n        zoneName=\"活着的记忆\",\n        zoneId=1192,\n        fatesList= {\n            collectionsFates= {\n                { fateName=\"良种难求\", npcName=\"无失哨兵GX\" },\n                { fateName=\"记忆的碎片\", npcName=\"无失哨兵GX\" }\n            },\n            otherNpcFates= {\n                { fateName=\"为了运河镇的安宁\", npcName=\"无失哨兵GX\" }, --24 防御\n                { fateName=\"亩鼠米卡：盛装巡游开始\", npcName=\"滑稽巡游主宰\" }  --23 一般\n            },\n            fatesWithContinuations =\n            {\n                { fateName=\"水城噩梦\", continuationIsBoss=true },\n                { fateName=\"亩鼠米卡：盛装巡游开始\", continuationIsBoss=true }\n            },\n            specialFates =\n            {\n                \"亩鼠米卡：盛装巡游皆大欢喜\"\n            },\n            blacklistedFates= {\n            }\n        }\n    }\n}\n\n--#endregion Data\n\n--#region Fate Functions\nfunction IsCollectionsFate(fateName)\n    for i, collectionsFate in ipairs(SelectedZone.fatesList.collectionsFates) do\n        if collectionsFate.fateName == fateName then\n            return true\n        end\n    end\n    return false\nend\n\nfunction IsBossFate(fateId)\n    local fateIcon = GetFateIconId(fateId)\n    return fateIcon == 60722\nend\n\nfunction IsOtherNpcFate(fateName)\n    for i, otherNpcFate in ipairs(SelectedZone.fatesList.otherNpcFates) do\n        if otherNpcFate.fateName == fateName then\n            return true\n        end\n    end\n    return false\nend\n\nfunction IsSpecialFate(fateName)\n    if SelectedZone.fatesList.specialFates == nil then\n        return false\n    end\n    for i, specialFate in ipairs(SelectedZone.fatesList.specialFates) do\n        if specialFate == fateName then\n            return true\n        end\n    end\nend\n\nfunction IsBlacklistedFate(fateName)\n    for i, blacklistedFate in ipairs(SelectedZone.fatesList.blacklistedFates) do\n        if blacklistedFate == fateName then\n            return true\n        end\n    end\n    if not JoinCollectionsFates then\n        for i, collectionsFate in ipairs(SelectedZone.fatesList.collectionsFates) do\n            if collectionsFate.fateName == fateName then\n                return true\n            end\n        end\n    end\n    return false\nend\n\nfunction GetFateNpcName(fateName)\n    for i, fate in ipairs(SelectedZone.fatesList.otherNpcFates) do\n        if fate.fateName == fateName then\n            return fate.npcName\n        end\n    end\n    for i, fate in ipairs(SelectedZone.fatesList.collectionsFates) do\n        if fate.fateName == fateName then\n            return fate.npcName\n        end\n    end\nend\n\nfunction IsFateActive(fateId)\n    local activeFates = GetActiveFates()\n    for i = 0, activeFates.Count-1 do\n        if fateId == activeFates[i] then\n            return true\n        end\n    end\n    return false\nend\n\nfunction EorzeaTimeToUnixTime(eorzeaTime)\n    return eorzeaTime/(144/7) -- 24h Eorzea Time equals 70min IRL\nend\n\nfunction SelectNextZone()\n    local nextZone = nil\n    local nextZoneId = GetZoneID()\n\n    for i, zone in ipairs(FatesData) do\n        if nextZoneId == zone.zoneId then\n            nextZone = zone\n        end\n    end\n    if nextZone == nil then\n        yield(\"/echo [FATE] 为支持当前区域。没有关于该区域的fate数据。\")\n        nextZone = {\n            zoneName = \"\",\n            zoneId = nextZoneId,\n            fatesList= {\n                collectionsFates= {},\n                otherNpcFates= {},\n                bossFates= {},\n                blacklistedFates= {},\n                fatesWithContinuations = {}\n            }\n        }\n    end\n\n    nextZone.zoneName = nextZone.zoneName\n    nextZone.aetheryteList = {}\n    local aetheryteIds = GetAetherytesInZone(nextZone.zoneId)\n    for i=0, aetheryteIds.Count-1 do\n        local aetherytePos = GetAetheryteRawPos(aetheryteIds[i])\n        local aetheryteTable = {\n            aetheryteName = GetAetheryteName(aetheryteIds[i]),\n            aetheryteId = aetheryteIds[i],\n            x = aetherytePos.Item1,\n            y = QueryMeshPointOnFloorY(aetherytePos.Item1, 1024, aetherytePos.Item2, true, 50),\n            z = aetherytePos.Item2\n        }\n        table.insert(nextZone.aetheryteList, aetheryteTable)\n    end\n\n    if nextZone.flying == nil then\n        nextZone.flying = true\n    end\n\n    return nextZone\nend\n\n--[[\n    Selects the better fate based on the priority order defined in FatePriority.\n    Default Priority order is \"Progress\" -> \"DistanceTeleport\" -> \"Bonus\" -> \"TimeLeft\" -> \"Distance\"\n]]\nfunction SelectNextFateHelper(tempFate, nextFate)\n    --Check if WaitForBonusIfBonusBuff is true, and have eithe buff, then set BonusFatesOnlyTemp to true\n    if BonusFatesOnly then\n        if not tempFate.isBonusFate and nextFate ~= nil and nextFate.isBonusFate then\n            return nextFate\n        elseif tempFate.isBonusFate and (nextFate == nil or not nextFate.isBonusFate) then\n            return tempFate\n        elseif not tempFate.isBonusFate and (nextFate == nil or not nextFate.isBonusFate) then\n            return nil\n        end\n        -- if both are bonus fates, go through the regular fate selection process\n    end\n\n    if tempFate.timeLeft < MinTimeLeftToIgnoreFate or tempFate.progress > CompletionToIgnoreFate then\n        LogInfo(\"[FATE] Ignoring fate #\"..tempFate.fateId..\" due to insufficient time or high completion.\")\n        return nextFate\n    elseif nextFate == nil then\n        LogInfo(\"[FATE] Selecting #\"..tempFate.fateId..\" because no other options so far.\")\n        return tempFate\n    elseif nextFate.timeLeft < MinTimeLeftToIgnoreFate or nextFate.progress > CompletionToIgnoreFate then\n        LogInfo(\"[FATE] Ignoring fate #\"..nextFate.fateId..\" due to insufficient time or high completion.\")\n        return tempFate\n    end\n\n    -- Evaluate based on priority (Loop through list return first non-equal priority)\n    for _, criteria in ipairs(FatePriority) do\n        if criteria == \"Progress\" then\n            LogInfo(\"[FATE] Comparing progress: \"..tempFate.progress..\" vs \"..nextFate.progress)\n            if tempFate.progress > nextFate.progress then return tempFate end\n            if tempFate.progress < nextFate.progress then return nextFate end\n        elseif criteria == \"Bonus\" then\n            LogInfo(\"[FATE] Checking bonus status: \"..tostring(tempFate.isBonusFate)..\" vs \"..tostring(nextFate.isBonusFate))\n            if tempFate.isBonusFate and not nextFate.isBonusFate then return tempFate end\n            if nextFate.isBonusFate and not tempFate.isBonusFate then return nextFate end\n        elseif criteria == \"TimeLeft\" then\n            LogInfo(\"[FATE] Comparing time left: \"..tempFate.timeLeft..\" vs \"..nextFate.timeLeft)\n            if tempFate.timeLeft > nextFate.timeLeft then return tempFate end\n            if tempFate.timeLeft < nextFate.timeLeft then return nextFate end\n        elseif criteria == \"Distance\" then\n            local tempDist = GetDistanceToPoint(tempFate.x, tempFate.y, tempFate.z)\n            local nextDist = GetDistanceToPoint(nextFate.x, nextFate.y, nextFate.z)\n            LogInfo(\"[FATE] Comparing distance: \"..tempDist..\" vs \"..nextDist)\n            if tempDist < nextDist then return tempFate end\n            if tempDist > nextDist then return nextFate end\n        elseif criteria == \"DistanceTeleport\" then\n            local tempDist = GetDistanceToPointWithAetheryteTravel(tempFate.x, tempFate.y, tempFate.z)\n            local nextDist = GetDistanceToPointWithAetheryteTravel(nextFate.x, nextFate.y, nextFate.z)\n            LogInfo(\"[FATE] Comparing distance: \"..tempDist..\" vs \"..nextDist)\n            if tempDist < nextDist then return tempFate end\n            if tempDist > nextDist then return nextFate end\n        end\n    end\n\n    -- Fallback: Select fate with the lower ID\n    LogInfo(\"[FATE] Selecting lower ID fate: \"..tempFate.fateId..\" vs \"..nextFate.fateId)\n    return (tempFate.fateId < nextFate.fateId) and tempFate or nextFate\nend\n\nfunction BuildFateTable(fateId)\n    local fateTable = {\n        fateId = fateId,\n        fateName = GetFateName(fateId),\n        progress = GetFateProgress(fateId),\n        duration = GetFateDuration(fateId),\n        startTime = GetFateStartTimeEpoch(fateId),\n        x = GetFateLocationX(fateId),\n        y = GetFateLocationY(fateId),\n        z = GetFateLocationZ(fateId),\n        isBonusFate = GetFateIsBonus(fateId),\n    }\n    fateTable.npcName = GetFateNpcName(fateTable.fateName)\n\n    local currentTime = EorzeaTimeToUnixTime(GetCurrentEorzeaTimestamp())\n    if fateTable.startTime == 0 then\n        fateTable.timeLeft = 900\n    else\n        fateTable.timeElapsed = currentTime - fateTable.startTime\n        fateTable.timeLeft = fateTable.duration - fateTable.timeElapsed\n    end\n\n    fateTable.isCollectionsFate = IsCollectionsFate(fateTable.fateName)\n    fateTable.isBossFate = IsBossFate(fateTable.fateId)\n    fateTable.isOtherNpcFate = IsOtherNpcFate(fateTable.fateName)\n    fateTable.isSpecialFate = IsSpecialFate(fateTable.fateName)\n    fateTable.isBlacklistedFate = IsBlacklistedFate(fateTable.fateName)\n\n    fateTable.continuationIsBoss = false\n    fateTable.hasContinuation = false\n    for _, continuationFate in ipairs(SelectedZone.fatesList.fatesWithContinuations) do\n        if fateTable.fateName == continuationFate.fateName then\n            fateTable.hasContinuation = true\n            fateTable.continuationIsBoss = continuationFate.continuationIsBoss\n        end\n    end\n\n    return fateTable\nend\n\n--Gets the Location of the next Fate. Prioritizes anything with progress above 0, then by shortest time left\nfunction SelectNextFate()\n    local fates = GetActiveFates()\n    if fates == nil then\n        return\n    end\n\n    local nextFate = nil\n    for i = 0, fates.Count-1 do\n        local tempFate = BuildFateTable(fates[i])\n        LogInfo(\"[FATE] Considering fate #\"..tempFate.fateId..\" \"..tempFate.fateName)\n        LogInfo(\"[FATE] Time left on fate #:\"..tempFate.fateId..\": \"..math.floor(tempFate.timeLeft//60)..\"min, \"..math.floor(tempFate.timeLeft%60)..\"s\")\n\n        if not (tempFate.x == 0 and tempFate.z == 0) then -- sometimes game doesn't send the correct coords\n            if not tempFate.isBlacklistedFate then -- check fate is not blacklisted for any reason\n                if tempFate.isBossFate then\n                    if (tempFate.isSpecialFate and tempFate.progress >= CompletionToJoinSpecialBossFates) or\n                        (not tempFate.isSpecialFate and tempFate.progress >= CompletionToJoinBossFate) then\n                        nextFate = SelectNextFateHelper(tempFate, nextFate)\n                    else\n                        LogInfo(\"[FATE] Skipping fate #\"..tempFate.fateId..\" \"..tempFate.fateName..\" due to boss fate with not enough progress.\")\n                    end\n                elseif (tempFate.isOtherNpcFate or tempFate.isCollectionsFate) and tempFate.startTime == 0 then\n                    if nextFate == nil then -- pick this if there's nothing else\n                        nextFate = tempFate\n                    elseif tempFate.isBonusFate then\n                        nextFate = SelectNextFateHelper(tempFate, nextFate)\n                    elseif nextFate.startTime == 0 then -- both fates are unopened npc fates\n                        nextFate = SelectNextFateHelper(tempFate, nextFate)\n                    end\n                elseif tempFate.duration ~= 0 then -- else is normal fate. avoid unlisted talk to npc fates\n                    nextFate = SelectNextFateHelper(tempFate, nextFate)\n                end\n                LogInfo(\"[FATE] Finished considering fate #\"..tempFate.fateId..\" \"..tempFate.fateName)\n            else\n                LogInfo(\"[FATE] Skipping fate #\"..tempFate.fateId..\" \"..tempFate.fateName..\" due to blacklist.\")\n            end\n        end\n    end\n\n    LogInfo(\"[FATE] Finished considering all fates\")\n\n    if nextFate == nil then\n        LogInfo(\"[FATE] 没有找到合适的FATE\")\n        if Echo == \"All\" then\n            yield(\"/echo [FATE] 未找到符合条件的 FATE。\")\n        end\n    else\n        LogInfo(\"[FATE] Final selected fate #\"..nextFate.fateId..\" \"..nextFate.fateName)\n    end\n    yield(\"/wait 0.211\")\n\n    return nextFate\nend\n\nfunction RandomAdjustCoordinates(x, y, z, maxDistance)\n    local angle = math.random() * 2 * math.pi\n    local x_adjust = maxDistance * math.random()\n    local z_adjust = maxDistance * math.random()\n\n    local randomX = x + (x_adjust * math.cos(angle))\n    local randomY = y + maxDistance\n    local randomZ = z + (z_adjust * math.sin(angle))\n\n    return randomX, randomY, randomZ\nend\n\n--#endregion Fate Functions\n\n--#region Movement Functions\n\nfunction DistanceFromClosestAetheryteToPoint(x, y, z, teleportTimePenalty)\n    local closestAetheryte = nil\n    local closestTravelDistance = math.maxinteger\n    for _, aetheryte in ipairs(SelectedZone.aetheryteList) do\n        local distanceAetheryteToFate = DistanceBetween(aetheryte.x, y, aetheryte.z, x, y, z)\n        local comparisonDistance = distanceAetheryteToFate + teleportTimePenalty\n        LogInfo(\"[FATE] Distance via \"..aetheryte.aetheryteName..\" adjusted for tp penalty is \"..tostring(comparisonDistance))\n\n        if comparisonDistance < closestTravelDistance then\n            LogInfo(\"[FATE] Updating closest aetheryte to \"..aetheryte.aetheryteName)\n            closestTravelDistance = comparisonDistance\n            closestAetheryte = aetheryte\n        end\n    end\n\n    return closestTravelDistance\nend\n\nfunction GetDistanceToPointWithAetheryteTravel(x, y, z)\n    -- Get the direct flight distance (no aetheryte)\n    local directFlightDistance = GetDistanceToPoint(x, y, z)\n    LogInfo(\"[FATE] Direct flight distance is: \" .. directFlightDistance)\n    \n    -- Get the distance to the closest aetheryte, including teleportation penalty\n    local distanceToAetheryte = DistanceFromClosestAetheryteToPoint(x, y, z, 200)\n    LogInfo(\"[FATE] Distance via closest Aetheryte is: \" .. (distanceToAetheryte or \"nil\"))\n\n    -- Return the minimum distance, either via direct flight or via the closest aetheryte travel\n    if distanceToAetheryte == nil then\n        return directFlightDistance\n    else\n        return math.min(directFlightDistance, distanceToAetheryte)\n    end\nend\n\nfunction GetClosestAetheryte(x, y, z, teleportTimePenalty)\n    local closestAetheryte = nil\n    local closestTravelDistance = math.maxinteger\n    for _, aetheryte in ipairs(SelectedZone.aetheryteList) do\n        local distanceAetheryteToFate = DistanceBetween(aetheryte.x, y, aetheryte.z, x, y, z)\n        local comparisonDistance = distanceAetheryteToFate + teleportTimePenalty\n        LogInfo(\"[FATE] Distance via \"..aetheryte.aetheryteName..\" adjusted for tp penalty is \"..tostring(comparisonDistance))\n\n        if comparisonDistance < closestTravelDistance then\n            LogInfo(\"[FATE] Updating closest aetheryte to \"..aetheryte.aetheryteName)\n            closestTravelDistance = comparisonDistance\n            closestAetheryte = aetheryte\n        end\n    end\n\n    return closestAetheryte\nend\n\nfunction GetClosestAetheryteToPoint(x, y, z, teleportTimePenalty)\n    local directFlightDistance = GetDistanceToPoint(x, y, z)\n    LogInfo(\"[FATE] Direct flight distance is: \"..directFlightDistance)\n    local closestAetheryte = GetClosestAetheryte(x, y, z, teleportTimePenalty)\n    if closestAetheryte ~= nil then\n        local aetheryteY = QueryMeshPointOnFloorY(closestAetheryte.x, y, closestAetheryte.z, true, 50)\n        if aetheryteY == nil then\n            aetheryteY = GetPlayerRawYPos()\n        end\n        local closestAetheryteDistance = DistanceBetween(x, y, z, closestAetheryte.x, aetheryteY, closestAetheryte.z) + teleportTimePenalty\n\n        if closestAetheryteDistance < directFlightDistance then\n            return closestAetheryte\n        end\n    end\n    return nil\nend\n\nfunction TeleportToClosestAetheryteToFate(nextFate)\n    local aetheryteForClosestFate = GetClosestAetheryteToPoint(nextFate.x, nextFate.y, nextFate.z, 200)\n    if aetheryteForClosestFate ~=nil then\n        TeleportTo(aetheryteForClosestFate.aetheryteName)\n        return true\n    end\n    return false\nend\n\nfunction AcceptTeleportOfferLocation(destinationAetheryte)\n    if IsAddonVisible(\"_NotificationTelepo\") then\n        local location = GetNodeText(\"_NotificationTelepo\", 3, 4)\n        yield(\"/callback _Notification true 0 16 \"..location)\n        yield(\"/wait 1\")\n    end\n\n    if IsAddonVisible(\"SelectYesno\") then\n        local teleportOfferMessage = GetNodeText(\"SelectYesno\", 15)\n        if type(teleportOfferMessage) == \"string\" then\n            local teleportOfferLocation = teleportOfferMessage:match(\"要接受前往“(.+)”的传送邀请吗%?\")\n            if teleportOfferLocation ~= nil then\n                if string.lower(teleportOfferLocation) == string.lower(destinationAetheryte) then\n                    yield(\"/callback SelectYesno true 0\") -- accept teleport\n                    return\n                else\n                    LogInfo(\"Offer for \"..teleportOfferLocation..\" and destination \"..destinationAetheryte..\" are not the same. Declining teleport.\")\n                end\n            end\n            yield(\"/callback SelectYesno true 2\") -- decline teleport\n            return\n        end\n    end\nend\n\nfunction AcceptNPCFateOrRejectOtherYesno()\n    if IsAddonVisible(\"SelectYesno\") then\n        local dialogBox = GetNodeText(\"SelectYesno\", 15)\n        if type(dialogBox) == \"string\" and dialogBox:find(\"此危命任务的推荐等级为\") then\n            yield(\"/callback SelectYesno true 0\") --accept fate\n        else\n            yield(\"/callback SelectYesno true 1\") --decline all other boxes\n        end\n    end\nend\n\nfunction TeleportTo(aetheryteName)\n    AcceptTeleportOfferLocation(aetheryteName)\n\n    while EorzeaTimeToUnixTime(GetCurrentEorzeaTimestamp()) - LastTeleportTimeStamp < 5 do\n        LogInfo(\"[FATE] Too soon since last teleport. Waiting...\")\n        yield(\"/wait 5.001\")\n    end\n\n    yield(\"/tp \"..aetheryteName)\n    yield(\"/wait 1\") -- wait for casting to begin\n    while GetCharacterCondition(CharacterCondition.casting) do\n        LogInfo(\"[FATE] Casting teleport...\")\n        yield(\"/wait 1\")\n    end\n    yield(\"/wait 1\") -- wait for that microsecond in between the cast finishing and the transition beginning\n    while GetCharacterCondition(CharacterCondition.betweenAreas) do\n        LogInfo(\"[FATE] Teleporting...\")\n        yield(\"/wait 1\")\n    end\n    yield(\"/wait 1\")\n    LastTeleportTimeStamp = EorzeaTimeToUnixTime(GetCurrentEorzeaTimestamp())\nend\n\nfunction ChangeInstance()\n    if SuccessiveInstanceChanges >= NumberOfInstances then\n        if CompanionScriptMode then\n            local shouldWaitForBonusBuff = WaitIfBonusBuff and (HasStatusId(1288) or HasStatusId(1289))\n            if WaitingForFateRewards == 0 and not shouldWaitForBonusBuff then\n                StopScript = true\n            else\n                LogInfo(\"[Fate Farming] Waiting for buff or fate rewards\")\n                yield(\"/wait 3\")\n            end\n        else\n            yield(\"/wait 10\")\n            SuccessiveInstanceChanges = 0\n        end\n        return\n    end\n\n    yield(\"/target 以太之光\") -- search for nearby aetheryte\n    if not HasTarget() or GetTargetName() ~= \"以太之光\" then -- if no aetheryte within targeting range, teleport to it\n        LogInfo(\"[FATE] Aetheryte not within targetable range\")\n        local closestAetheryte = nil\n        local closestAetheryteDistance = math.maxinteger\n        for i, aetheryte in ipairs(SelectedZone.aetheryteList) do\n            -- GetDistanceToPoint is implemented with raw distance instead of distance squared\n            local distanceToAetheryte = GetDistanceToPoint(aetheryte.x, aetheryte.y, aetheryte.z)\n            if distanceToAetheryte < closestAetheryteDistance then\n                closestAetheryte = aetheryte\n                closestAetheryteDistance = distanceToAetheryte\n            end\n        end\n        TeleportTo(closestAetheryte.aetheryteName)\n        return\n    end\n\n    if WaitingForFateRewards ~= 0 then\n        yield(\"/wait 10\")\n        return\n    end\n\n    if GetDistanceToTarget() > 10 then\n        LogInfo(\"[FATE] Targeting aetheryte, but greater than 10 distance\")\n        if GetDistanceToTarget() > 20 and not GetCharacterCondition(CharacterCondition.mounted) then\n            State = CharacterState.mounting\n            LogInfo(\"[FATE] State Change: Mounting\")\n        elseif not (PathfindInProgress() or PathIsRunning()) then\n            PathfindAndMoveTo(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos(), GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n        end\n        return\n    end\n\n    LogInfo(\"[FATE] Within 10 distance\")\n    if PathfindInProgress() or PathIsRunning() then\n        yield(\"/vnav stop\")\n        return\n    end\n\n    if GetCharacterCondition(CharacterCondition.mounted) then\n   -- yield(\"/wait 1\")\n        State = CharacterState.changeInstanceDismount\n        LogInfo(\"[FATE] State Change: ChangeInstanceDismount\")\n        return\n    end\n\n    LogInfo(\"[FATE] Transferring to next instance\")\n    local nextInstance = (GetZoneInstance() % 2) + 1\n    yield(\"/li \"..nextInstance) -- start instance transfer\n    yield(\"/wait 5\") -- wait for instance transfer to register 过短延迟会导致连续使用命令卡死\n    State = CharacterState.ready\n    SuccessiveInstanceChanges = SuccessiveInstanceChanges + 1\n    LogInfo(\"[FATE] State Change: Ready\")\nend\n\nfunction WaitForContinuation()\n    if IsInFate() then\n        LogInfo(\"WaitForContinuation IsInFate\")\n        local nextFateId = GetNearestFate()\n        if nextFateId ~= CurrentFate.fateId then\n            CurrentFate = BuildFateTable(nextFateId)\n            State = CharacterState.doFate\n            LogInfo(\"[FATE] State Change: DoFate\")\n        end\n    elseif os.clock() - LastFateEndTime > 30 then\n        LogInfo(\"WaitForContinuation Abort\")\n        LogInfo(\"Over 30s since end of last fate. Giving up on part 2.\")\n        TurnOffCombatMods()\n        State = CharacterState.ready\n        LogInfo(\"State Change: Ready\")\n    else\n        LogInfo(\"WaitForContinuation Else\")\n        if BossFatesClass ~= nil then\n            local currentClass = GetClassJobId()\n            LogInfo(\"WaitForContinuation \"..CurrentFate.fateName)\n            if not IsPlayerOccupied() then\n                if CurrentFate.continuationIsBoss and currentClass ~= BossFatesClass.classId then\n                    LogInfo(\"WaitForContinuation SwitchToBoss\")\n                    yield(\"/gs change \"..BossFatesClass.className)\n                elseif not CurrentFate.continuationIsBoss and currentClass ~= MainClass.classId then\n                    LogInfo(\"WaitForContinuation SwitchToMain\")\n                    yield(\"/gs change \"..MainClass.className)\n                end\n            end\n        end\n\n        yield(\"/wait 1\")\n    end\nend\n\nfunction FlyBackToAetheryte()\n    NextFate = SelectNextFate()\n    if NextFate ~= nil then\n        yield(\"/vnav stop\")\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        return\n    end\n\n    local x = GetPlayerRawXPos()\n    local y = GetPlayerRawYPos()\n    local z = GetPlayerRawZPos()\n    local closestAetheryte = GetClosestAetheryte(x, y, z, 0)\n    -- if you get any sort of error while flying back, then just abort and tp back\n    if IsAddonVisible(\"_TextError\") and GetNodeText(\"_TextError\", 1) == \"抵达高度上限，无法继续提升高度。\" then\n        yield(\"/vnav stop\")\n        TeleportTo(closestAetheryte.aetheryteName)\n        return\n    end\n\n    yield(\"/target 以太之光\")\n\n    if HasTarget() and GetTargetName() == \"以太之光\" and DistanceBetween(GetTargetRawXPos(), y, GetTargetRawZPos(), x, y, z) <= 20 then\n        if PathfindInProgress() or PathIsRunning() then\n            yield(\"/vnav stop\")\n        end\n\n        if GetCharacterCondition(CharacterCondition.flying) then\n            yield(\"/ac 跳下\") -- land but don't actually dismount, to avoid running chocobo timer\n        elseif GetCharacterCondition(CharacterCondition.mounted) then\n            State = CharacterState.ready\n            LogInfo(\"[FATE] State Change: Ready\")\n        else\n            if MountToUse == \"随机飞行坐骑\" then\n                yield('/gaction \"随机飞行坐骑\"')\n            else\n                yield('/mount \"' .. MountToUse)\n            end\n        end\n        return\n    end\n\n    if not GetCharacterCondition(CharacterCondition.mounted) then\n        State = CharacterState.mounting\n        LogInfo(\"[FATE] State Change: Mounting\")\n        return\n    end\n    \n    if not (PathfindInProgress() or PathIsRunning()) then\n        LogInfo(\"[FATE] ClosestAetheryte.y: \"..closestAetheryte.y)\n        if closestAetheryte ~= nil then\n            SetMapFlag(SelectedZone.zoneId, closestAetheryte.x, closestAetheryte.y, closestAetheryte.z)\n            if (not GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying) then --补充缺失的动作，在执行回到目标以太之光前尝试进入飞行状态\n            yield('/gaction 跳跃')\n            yield('/wait 1')\n            end\n            PathfindAndMoveTo(closestAetheryte.x, closestAetheryte.y, closestAetheryte.z, GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n        end\n    end\nend\n\nfunction Mount()\n    if GetCharacterCondition(CharacterCondition.mounted) then\n    --yield(\"/wait 1\")\n        State = CharacterState.moveToFate\n        LogInfo(\"[FATE] State Change: MoveToFate\")\n    else\n        if MountToUse == \"随机飞行坐骑\" then\n            yield('/gaction \"随机飞行坐骑\"')\n        else\n            yield('/mount \"' .. MountToUse)\n        end\n    end\n    yield(\"/wait 1\")\nend\n\nfunction Dismount()\n    if GetCharacterCondition(CharacterCondition.flying) then\n        yield('/ac 跳下')\n\n        local now = os.clock()\n        if now - LastStuckCheckTime > 1 then\n            local x = GetPlayerRawXPos()\n            local y = GetPlayerRawYPos()\n            local z = GetPlayerRawZPos()\n\n            if GetCharacterCondition(CharacterCondition.flying) and GetDistanceToPoint(LastStuckCheckPosition.x, LastStuckCheckPosition.y, LastStuckCheckPosition.z) < 2 then\n                LogInfo(\"[FATE] Unable to dismount here. Moving to another spot.\")\n                local random_x, random_y, random_z = RandomAdjustCoordinates(x, y, z, 10)\n                local nearestPointX = QueryMeshNearestPointX(random_x, random_y, random_z, 100, 100)\n                local nearestPointY = QueryMeshNearestPointY(random_x, random_y, random_z, 100, 100)\n                local nearestPointZ = QueryMeshNearestPointZ(random_x, random_y, random_z, 100, 100)\n                if nearestPointX ~= nil and nearestPointY ~= nil and nearestPointZ ~= nil then\n                    PathfindAndMoveTo(nearestPointX, nearestPointY, nearestPointZ, GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n                    yield(\"/wait 1\")\n                end\n            end\n\n            LastStuckCheckTime = now\n            LastStuckCheckPosition = {x=x, y=y, z=z}\n        end\n    elseif GetCharacterCondition(CharacterCondition.mounted) then\n        yield('/ac 跳下')\n    end\nend\n\nfunction MiddleOfFateDismount()\n    if not IsFateActive(CurrentFate.fateId) then\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        return\n    end\n\n    if HasTarget() then\n        if DistanceBetween(GetPlayerRawXPos(), 0, GetPlayerRawZPos(), GetTargetRawXPos(), 0, GetTargetRawZPos()) > (MaxDistance + GetTargetHitboxRadius() + 5) then\n            if not (PathfindInProgress() or PathIsRunning()) then\n                LogInfo(\"[FATE] MiddleOfFateDismount PathfindAndMoveTo\")\n                PathfindAndMoveTo(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos(), GetCharacterCondition(CharacterCondition.flying))\n            end\n        else\n            if GetCharacterCondition(CharacterCondition.mounted) then\n                LogInfo(\"[FATE] MiddleOfFateDismount Dismount()\")\n                Dismount()\n            else\n                yield(\"/vnav stop\")\n                State = CharacterState.doFate\n                LogInfo(\"[FATE] State Change: DoFate\")\n            end\n        end\n    else\n        TargetClosestFateEnemy()\n    end\nend\n\nfunction NPCDismount()\n    if GetCharacterCondition(CharacterCondition.mounted) then\n        Dismount()\n    else\n        State = CharacterState.interactWithNpc\n        LogInfo(\"[FATE] State Change: InteractWithFateNpc\")\n    end\nend\n\nfunction ChangeInstanceDismount()\n    if GetCharacterCondition(CharacterCondition.mounted) then\n        Dismount()\n    else\n        State = CharacterState.changingInstances\n        LogInfo(\"[FATE] State Change: ChangingInstance\")\n    end\nend\n\n--Paths to the Fate NPC Starter\nfunction MoveToNPC()\n    yield(\"/target \"..CurrentFate.npcName)\n    if HasTarget() and GetTargetName()==CurrentFate.npcName then\n        if GetDistanceToTarget() > 5 then\n            PathfindAndMoveTo(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos(), false)\n        end\n    end\nend\n\n--Paths to the Fate. CurrentFate is set here to allow MovetoFate to change its mind,\n--so CurrentFate is possibly nil.\nfunction MoveToFate()\n    SuccessiveInstanceChanges = 0\n\n    if not IsPlayerAvailable() then\n        yield(\"/echo [FATE] 玩家不可用\")\n        return\n    end\n\n    if CurrentFate~=nil and not IsFateActive(CurrentFate.fateId) then\n        LogInfo(\"[FATE] Next Fate is dead, selecting new Fate.\")\n        yield(\"/vnav stop\")\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        return\n    end\n\n    NextFate = SelectNextFate()\n    if NextFate == nil then -- when moving to next fate, CurrentFate == NextFate\n        yield(\"/vnav stop\")\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        return\n    elseif CurrentFate == nil or NextFate.fateId ~= CurrentFate.fateId then\n        yield(\"/vnav stop\")\n        CurrentFate = NextFate\n        SetMapFlag(SelectedZone.zoneId, CurrentFate.x, CurrentFate.y, CurrentFate.z)\n        yield(\"/\"..ChatCommandType..\" <flag>1\")\n        return\n    end\n\n    -- change to secondary class if it's a boss fate\n    if BossFatesClass ~= nil then\n        local currentClass = GetClassJobId()\n        if CurrentFate.isBossFate and currentClass ~= BossFatesClass.classId then\n            yield(\"/gs change \"..BossFatesClass.className)\n            return\n        elseif not CurrentFate.isBossFate and currentClass ~= MainClass.classId then\n            yield(\"/gs change \"..MainClass.className)\n            return\n        end\n    end\n\n    -- upon approaching fate, pick a target and switch to pathing towards target\n    if GetDistanceToPoint(CurrentFate.x, CurrentFate.y, CurrentFate.z) < 60 then\n        if HasTarget() then\n            LogInfo(\"[FATE] Found FATE target, immediate rerouting\")\n            PathfindAndMoveTo(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos())\n            if (CurrentFate.isOtherNpcFate or CurrentFate.isCollectionsFate) then\n                State = CharacterState.interactWithNpc\n                LogInfo(\"[FATE] State Change: Interact with npc\")\n            -- if GetTargetName() == CurrentFate.npcName then\n            --     State = CharacterState.interactWithNpc\n            -- elseif GetTargetFateID() == CurrentFate.fateId then\n            --     State = CharacterState.middleOfFateDismount\n            --     LogInfo(\"[FATE] State Change: MiddleOfFateDismount\")\n            else\n                State = CharacterState.middleOfFateDismount\n                LogInfo(\"[FATE] State Change: MiddleOfFateDismount\")\n            end\n            return\n        else\n            if (CurrentFate.isOtherNpcFate or CurrentFate.isCollectionsFate) and not IsInFate() then\n                yield(\"/target \"..CurrentFate.npcName)\n            else\n                TargetClosestFateEnemy()\n            end\n            yield(\"/wait 0.5\") -- 等待0.5秒以保证目标选中\n            return\n        end\n    end\n\n    -- check for stuck\n    if (PathIsRunning() or PathfindInProgress()) and GetCharacterCondition(CharacterCondition.mounted) then\n        local now = os.clock()\n        if now - LastStuckCheckTime > 10 then\n            local x = GetPlayerRawXPos()\n            local y = GetPlayerRawYPos()\n            local z = GetPlayerRawZPos()\n\n            if GetDistanceToPoint(LastStuckCheckPosition.x, LastStuckCheckPosition.y, LastStuckCheckPosition.z) < 3 then\n                yield(\"/vnav stop\")\n                yield(\"/wait 1\")\n                LogInfo(\"[FATE] Antistuck\")\n                PathfindAndMoveTo(x, y + 10, z, GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying) -- fly up 10 then try again\n            end\n            \n            LastStuckCheckTime = now\n            LastStuckCheckPosition = {x=x, y=y, z=z}\n        end\n        return\n    end\n\n    if not MovingAnnouncementLock then\n        LogInfo(\"[FATE] Moving to fate #\"..CurrentFate.fateId..\" \"..CurrentFate.fateName)\n        MovingAnnouncementLock = true\n        if Echo == \"All\" then\n            --yield(\"/echo [FATE] 移动到FATE #\"..CurrentFate.fateId..\" \"..CurrentFate.fateName)\n        end\n    end\n\n    if TeleportToClosestAetheryteToFate(CurrentFate) then\n        return\n    end\n\n    if not GetCharacterCondition(CharacterCondition.mounted) then\n        State = CharacterState.mounting\n        LogInfo(\"[FATE] State Change: Mounting\")\n        return\n    end\n\n    local nearestLandX, nearestLandY, nearestLandZ = CurrentFate.x, CurrentFate.y, CurrentFate.z\n    if not (CurrentFate.isCollectionsFate or CurrentFate.isOtherNpcFate) then\n        nearestLandX, nearestLandY, nearestLandZ = RandomAdjustCoordinates(CurrentFate.x, CurrentFate.y, CurrentFate.z, 10)\n    end\n\n    --if GetDistanceToPoint(nearestLandX, nearestLandY, nearestLandZ) > 5 then\n    if (GetDistanceToPoint(nearestLandX, nearestLandY, nearestLandZ) > 5 and not GetCharacterCondition(CharacterCondition.flying))  then -- 补充缺失的动作，在寻路到FATE前跳跃进入飞行状态\n        yield(\"/gaction 跳跃\")\n        yield(\"/wait 1\")\n        PathfindAndMoveTo(nearestLandX, nearestLandY, nearestLandZ, HasFlightUnlocked(SelectedZone.zoneId) and SelectedZone.flying)\n    elseif (GetDistanceToPoint(nearestLandX, nearestLandY, nearestLandZ) > 5 and GetCharacterCondition(CharacterCondition.flying)) then\n        PathfindAndMoveTo(nearestLandX, nearestLandY, nearestLandZ, HasFlightUnlocked(SelectedZone.zoneId) and SelectedZone.flying)\n    else\n        State = CharacterState.middleOfFateDismount\n    end\nend\n\nfunction InteractWithFateNpc()\n    if IsInFate() or GetFateStartTimeEpoch(CurrentFate.fateId) > 0 then\n        yield(\"/vnav stop\")\n        State = CharacterState.doFate\n        LogInfo(\"[FATE] State Change: DoFate\")\n        yield(\"/wait 1\") -- give the fate a second to register before dofate and lsync\n    elseif not IsFateActive(CurrentFate.fateId) then\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n    elseif PathfindInProgress() or PathIsRunning() then\n        if HasTarget() and GetTargetName() == CurrentFate.npcName and GetDistanceToTarget() < (5*math.random()) then\n            yield(\"/vnav stop\")\n        end\n        return\n    else\n        -- if target is already selected earlier during pathing, avoids having to target and move again\n        if (not HasTarget() or GetTargetName()~=CurrentFate.npcName) then\n            yield(\"/target \"..CurrentFate.npcName)\n            return\n        end\n\n        if GetCharacterCondition(CharacterCondition.mounted) then\n            State = CharacterState.npcDismount\n            LogInfo(\"[FATE] State Change: NPCDismount\")\n            return\n        end\n\n        if GetDistanceToPoint(GetTargetRawXPos(), GetPlayerRawYPos(), GetTargetRawZPos()) > 5 then\n            MoveToNPC()\n            return\n        end\n\n        if IsAddonVisible(\"SelectYesno\") then\n            AcceptNPCFateOrRejectOtherYesno()\n        elseif not GetCharacterCondition(CharacterCondition.occupied) then\n            yield(\"/interact\")\n        end\n    end\nend\n\nfunction CollectionsFateTurnIn()\n    AcceptNPCFateOrRejectOtherYesno()\n\n    if CurrentFate ~= nil and not IsFateActive(CurrentFate.fateId) then\n        CurrentFate = nil\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        return\n    end\n\n    if (not HasTarget() or GetTargetName()~=CurrentFate.npcName) then\n        TurnOffCombatMods()\n        yield(\"/target \"..CurrentFate.npcName)\n        yield(\"/wait 1\")\n\n        -- if too far from npc to target, then head towards center of fate\n        if (not HasTarget() or GetTargetName()~=CurrentFate.npcName and GetFateProgress(CurrentFate.fateId) < 100) then\n            if not PathfindInProgress() and not PathIsRunning() then\n                PathfindAndMoveTo(CurrentFate.x, CurrentFate.y, CurrentFate.z)\n            end\n        else\n            yield(\"/vnav stop\")\n        end\n        return\n    end\n\n    if GetDistanceToPoint(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos()) > 5 then\n        if not (PathfindInProgress() or PathIsRunning()) then\n            MoveToNPC()\n        end\n    else\n        if GetItemCount(GetFateEventItem(CurrentFate.fateId)) >= 5 then --原7，修改默认值为5，因为单人数值下FATE仅需提交18个物品即完成，同时由于主动攻击导致收集到5个物品时往往仍处于战斗状态会获得比预期更多的物品\n            GotCollectionsFullCredit = true\n        end\n\n        yield(\"/vnav stop\")\n        yield(\"/interact\")\n        yield(\"/wait 3\")\n\n        if GetFateProgress(CurrentFate.fateId) < 100 then\n            TurnOnCombatMods()\n            State = CharacterState.doFate\n            LogInfo(\"[FATE] State Change: DoFate\")\n        else\n            if GotCollectionsFullCredit then\n                State = CharacterState.unexpectedCombat\n                LogInfo(\"[FATE] State Change: UnexpectedCombat\")\n            end\n        end\n\n        if CurrentFate ~=nil and CurrentFate.npcName ~=nil and GetTargetName() == CurrentFate.npcName then\n            LogInfo(\"[FATE] Attempting to clear target.\")\n            ClearTarget()\n            yield(\"/wait 1\")\n        end\n    end\nend\n\n--#endregion\n\n--#region Combat Functions\n\nfunction GetClassJobTableFromId(jobId)\n    if jobId == nil then\n        LogInfo(\"[FATE] JobId is nil\")\n        return nil\n    end\n    for _, classJob in pairs(ClassList) do\n        if classJob.classId == jobId then\n            return classJob\n        end\n    end\n    LogInfo(\"[FATE] Cannot recognize combat job.\")\n    return nil\nend\n\nfunction GetClassJobTableFromAbbrev(classString)\n    if classString == \"\" then\n        LogInfo(\"[FATE] No class set\")\n        return nil\n    end\n    for classJobAbbrev, classJob in pairs(ClassList) do\n        if classJobAbbrev == string.lower(classString) then\n            return classJob\n        end\n    end\n    LogInfo(\"[FATE] Cannot recognize combat job.\")\n    return nil\nend\n\nfunction SummonChocobo()\n    if GetCharacterCondition(CharacterCondition.mounted) then\n        Dismount()\n        return\n    end\n\n    if ShouldSummonChocobo and GetBuddyTimeRemaining() <= ResummonChocoboTimeLeft then\n        if GetItemCount(4868) > 0 then\n            yield(\"/item 基萨尔野菜\")\n            yield(\"/wait 3\")\n            yield(\"/cac \"..ChocoboStance)\n        elseif ShouldAutoBuyGysahlGreens then\n            State = CharacterState.autoBuyGysahlGreens\n            LogInfo(\"[FATE] State Change: AutoBuyGysahlGreens\")\n            return\n        end\n    end\n    State = CharacterState.ready\n    LogInfo(\"[FATE] State Change: Ready\")\nend\n\nfunction AutoBuyGysahlGreens()\n    if GetItemCount(4868) > 0 then -- don't need to buy\n        if IsAddonVisible(\"Shop\") then\n            yield(\"/callback Shop true -1\")\n        elseif IsInZone(SelectedZone.zoneId) then\n            yield(\"/item 基萨尔野菜\")\n        else\n            State = CharacterState.ready\n            LogInfo(\"State Change: ready\")\n        end\n        return\n    else\n        if not IsInZone(129) then\n            yield(\"/vnav stop\")\n            TeleportTo(\"利姆萨·罗敏萨下层甲板\")\n            return\n        else\n            local gysahlGreensVendor = { x=-62.1, y=18.0, z=9.4, npcName=\"班戈·赞戈\" }\n            --local gysahlGreensVendor = { x=-62.1, y=18.0, z=9.4, npcName=\"布鲁盖尔商会 班戈·赞戈\" }\n            if GetDistanceToPoint(gysahlGreensVendor.x, gysahlGreensVendor.y, gysahlGreensVendor.z) > 5 then\n                if not (PathIsRunning() or PathfindInProgress()) then\n                    PathfindAndMoveTo(gysahlGreensVendor.x, gysahlGreensVendor.y, gysahlGreensVendor.z)\n                end\n            elseif HasTarget() and GetTargetName() == gysahlGreensVendor.npcName then\n                yield(\"/vnav stop\")\n                yield(\"/echo 有目标\")\n                if IsAddonVisible(\"SelectYesno\") then\n                    yield(\"/callback SelectYesno true 0\")\n                elseif IsAddonVisible(\"SelectIconString\") then\n                    yield(\"/callback SelectIconString true 0\")\n                    return\n                elseif IsAddonVisible(\"Shop\") then\n                    yield(\"/callback Shop true 0 2 99\")\n                    return\n                elseif not GetCharacterCondition(CharacterCondition.occupied) then\n                    yield(\"/interact\")\n                    yield(\"/wait 1\")\n                    return\n                end\n            else\n                yield(\"/vnav stop\")\n                yield(\"/target \"..gysahlGreensVendor.npcName)\n            end\n        end\n    end\nend\n\n--Paths to the enemy (for Meele)\nfunction EnemyPathing()\n    while HasTarget() and GetDistanceToTarget() > (GetTargetHitboxRadius() + MaxDistance) do\n        local enemy_x = GetTargetRawXPos()\n        local enemy_y = GetTargetRawYPos()\n        local enemy_z = GetTargetRawZPos()\n        if PathIsRunning() == false then\n            PathfindAndMoveTo(enemy_x, enemy_y, enemy_z, GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n        end\n        yield(\"/wait 0.1\")\n    end\nend\n\nfunction TurnOnAoes()\n    if not AoesOn then\n        if RotationPlugin == \"RSR\" then\n            yield(\"/rotation off\")\n            yield(\"/rotation auto on\")\n            LogInfo(\"[FATE] TurnOnAoes /rotation auto on\")\n\n            if RSRAoeType == \"Off\" then\n                yield(\"/rotation settings aoetype 0\")\n            elseif RSRAoeType == \"Cleave\" then\n                yield(\"/rotation settings aoetype 1\")\n            elseif RSRAoeType == \"Full\" then\n                yield(\"/rotation settings aoetype 2\")\n            end\n        elseif RotationPlugin == \"BMR\" then\n            yield(\"/bmrai setpresetname \"..RotationAoePreset)\n        elseif RotationPlugin == \"VBM\" then\n            yield(\"/vbm ar toggle \"..RotationAoePreset)\n        end\n        AoesOn = true\n    end\nend\n\nfunction TurnOffAoes()\n    if AoesOn then\n        if RotationPlugin == \"RSR\" then\n            yield(\"/rotation settings aoetype 1\")\n            yield(\"/rotation manual\")\n            LogInfo(\"[FATE] TurnOffAoes /rotation manual\")\n        elseif RotationPlugin == \"BMR\" then\n            yield(\"/bmrai setpresetname \"..RotationSingleTargetPreset)\n        elseif RotationPlugin == \"VBM\" then\n            yield(\"/vbm ar toggle \"..RotationSingleTargetPreset)\n        end\n        AoesOn = false\n    end\nend\n\nfunction TurnOffRaidBuffs()\n    if AoesOn then\n        if RotationPlugin == \"BMR\" then\n            yield(\"/bmrai setpresetname \"..RotationHoldBuffPreset)\n        elseif RotationPlugin == \"VBM\" then\n            yield(\"/vbm ar toggle \"..RotationHoldBuffPreset)\n        end\n    end\nend\n\nfunction SetMaxDistance()\n    MaxDistance = MeleeDist --default to melee distance\n    --ranged and casters have a further max distance so not always running all way up to target\n    local currentClass = GetClassJobTableFromId(GetClassJobId())\n    if not currentClass.isMelee then\n        MaxDistance = RangedDist\n    end\nend\n\nfunction TurnOnCombatMods(rotationMode)\n    if not CombatModsOn then\n        CombatModsOn = true\n        -- turn on RSR in case you have the RSR 30 second out of combat timer set\n        if RotationPlugin == \"RSR\" then\n            if rotationMode == \"manual\" then\n                yield(\"/rotation manual\")\n                LogInfo(\"[FATE] TurnOnCombatMods /rotation manual\")\n            else\n                yield(\"/rotation off\")\n                yield(\"/rotation auto on\")\n                LogInfo(\"[FATE] TurnOnCombatMods /rotation auto on\")\n            end\n        elseif RotationPlugin == \"BMR\" then\n            yield(\"/bmrai setpresetname \"..RotationAoePreset)\n        elseif RotationPlugin == \"VBM\" then\n            yield(\"/vbm ar toggle \"..RotationAoePreset)\n        elseif RotationPlugin == \"Wrath\" then\n            yield(\"/wrath auto on\")\n        end\n\n        local class = GetClassJobTableFromId(GetClassJobId())\n        \n        if not AiDodgingOn then\n            SetMaxDistance()\n            \n            if DodgingPlugin == \"BMR\" then\n                yield(\"/bmrai on\")\n                yield(\"/bmrai followtarget on\") -- overrides navmesh path and runs into walls sometimes\n                yield(\"/bmrai followcombat on\")\n                -- yield(\"/bmrai followoutofcombat on\")\n                yield(\"/bmrai maxdistancetarget \" .. MaxDistance)\n            elseif DodgingPlugin == \"VBM\" then\n                yield(\"/vbmai on\")\n                yield(\"/vbmai followtarget on\") -- overrides navmesh path and runs into walls sometimes\n                yield(\"/vbmai followcombat on\")\n                -- yield(\"/bmrai followoutofcombat on\")\n                yield(\"/vbmai maxdistancetarget \" .. MaxDistance)\n                if RotationPlugin ~= \"VBM\" then\n                    yield(\"/vbmai ForbidActions on\") --This Disables VBM AI Auto-Target\n                end\n            end\n            AiDodgingOn = true\n        end\n    end\nend\n\nfunction TurnOffCombatMods()\n    if CombatModsOn then\n        LogInfo(\"[FATE] Turning off combat mods\")\n        CombatModsOn = false\n\n        if RotationPlugin == \"RSR\" then\n            yield(\"/rotation off\")\n            LogInfo(\"[FATE] TurnOffCombatMods /rotation off\")\n        elseif RotationPlugin == \"BMR\" or RotationPlugin == \"VBM\" then\n            yield(\"/bmrai setpresetname null\")\n        elseif RotationPlugin == \"Wrath\" then\n            yield(\"/wrath auto off\")\n        elseif RotationPlugin == \"AE\" then\n            yield(\"/aestop on\")\n            yield(\"/aepull off\")\n            LogInfo(\"[FATE] AE rotation is now inactive\")\n        end\n\n        -- turn off BMR so you don't start following other mobs\n        if AiDodgingOn then\n            if DodgingPlugin == \"BMR\" then\n                yield(\"/bmrai off\")\n                yield(\"/bmrai followtarget off\")\n                yield(\"/bmrai followcombat off\")\n                yield(\"/bmrai followoutofcombat off\")\n            elseif DodgingPlugin == \"VBM\" then\n                yield(\"/vbm ar disable\")\n                yield(\"/vbmai off\")\n                yield(\"/vbmai followtarget off\")\n                yield(\"/vbmai followcombat off\")\n                yield(\"/vbmai followoutofcombat off\")\n                if RotationPlugin ~= \"VBM\" then\n                    yield(\"/vbmai ForbidActions off\") --This Enables VBM AI Auto-Target\n                end\n            end\n            AiDodgingOn = false\n        end\n    end\nend\n\nfunction HandleUnexpectedCombat()\n    TurnOnCombatMods(\"manual\")\n\n    if IsInFate() and GetFateProgress(GetNearestFate()) < 100 then\n        CurrentFate = BuildFateTable(GetNearestFate())\n        State = CharacterState.doFate\n        LogInfo(\"[FATE] State Change: DoFate\")\n        return\n    elseif not GetCharacterCondition(CharacterCondition.inCombat) then\n        yield(\"/vnav stop\")\n        ClearTarget()\n        TurnOffCombatMods()\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        local randomWait = (math.floor(math.random()*MaxWait * 1000)/1000) + MinWait -- truncated to 3 decimal places\n        yield(\"/wait \"..randomWait)\n        return\n    end\n\n    if GetCharacterCondition(CharacterCondition.mounted) then\n        if not (PathfindInProgress() or PathIsRunning()) then\n            PathfindAndMoveTo(GetPlayerRawXPos(), GetPlayerRawYPos() + 10, GetPlayerRawZPos(), true)\n        end\n        yield(\"/wait 10\")\n        return\n    end\n\n    -- targets whatever is trying to kill you\n    if not HasTarget() then\n        yield(\"/battletarget\")\n    end\n\n    -- pathfind closer if enemies are too far\n    if HasTarget() then\n        if GetDistanceToTarget() > (MaxDistance + GetTargetHitboxRadius()) then\n            if not (PathfindInProgress() or PathIsRunning()) then\n                PathfindAndMoveTo(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos(), GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n            end\n        else\n            if PathfindInProgress() or PathIsRunning() then\n                yield(\"/vnav stop\")\n            elseif not GetCharacterCondition(CharacterCondition.inCombat) then\n                --inch closer 3 seconds\n                PathfindAndMoveTo(GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos(), GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n                yield(\"/wait 3\")\n            end\n        end\n    end\n    yield(\"/wait 0.5\")\nend\n\nfunction DoFate()\n    if WaitingForFateRewards ~= CurrentFate.fateId then\n        WaitingForFateRewards = CurrentFate.fateId\n        LogInfo(\"[FATE] WaitingForFateRewards DoFate: \"..tostring(WaitingForFateRewards))\n    end\n    local currentClass = GetClassJobId()\n    -- switch classes (mostly for continutation fates that pop you directly into the next one)\n    if CurrentFate.isBossFate and BossFatesClass ~= nil and currentClass ~= BossFatesClass.classId and not IsPlayerOccupied() then\n        TurnOffCombatMods()\n        yield(\"/gs change \"..BossFatesClass.className)\n        yield(\"/wait 1\")\n        return\n    elseif not CurrentFate.isBossFate and BossFatesClass ~= nil and currentClass ~= MainClass.classId and not IsPlayerOccupied() then\n        TurnOffCombatMods()\n        yield(\"/gs change \"..MainClass.className)\n        yield(\"/wait 1\")\n        return\n    elseif IsInFate() and (GetFateMaxLevel(CurrentFate.fateId) < GetLevel()) and not IsLevelSynced() then\n        yield(\"/lsync\")\n        yield(\"/wait 0.5\") -- give it a second to register\n    elseif IsFateActive(CurrentFate.fateId) and not IsInFate() and GetFateProgress(CurrentFate.fateId) < 100 and\n        (GetDistanceToPoint(CurrentFate.x, CurrentFate.y, CurrentFate.z) < GetFateRadius(CurrentFate.fateId) + 10) and\n        not GetCharacterCondition(CharacterCondition.mounted) and not (PathIsRunning() or PathfindInProgress())\n    then -- got pushed out of fate. go back\n        yield(\"/vnav stop\")\n        yield(\"/wait 0.5\")\n        LogInfo(\"[FATE] pushed out of fate going back!\")\n        PathfindAndMoveTo(CurrentFate.x, CurrentFate.y, CurrentFate.z, GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n        return\n    elseif not IsFateActive(CurrentFate.fateId) or GetFateProgress(CurrentFate.fateId) == 100 then\n        yield(\"/vnav stop\")\n        ClearTarget()\n        if not LogInfo(\"[FATE] HasContintuation check\") and CurrentFate.hasContinuation then\n            LastFateEndTime = os.clock()\n            State = CharacterState.waitForContinuation\n            LogInfo(\"[FATE] State Change: WaitForContinuation\")\n            return\n        else\n            DidFate = true\n            LogInfo(\"[FATE] No continuation for \"..CurrentFate.fateName)\n            local randomWait = (math.floor(math.random() * (math.max(0, MaxWait - 3)) * 1000)/1000) + MinWait -- truncated to 3 decimal places\n            yield(\"/wait \"..randomWait)\n            TurnOffCombatMods()\n            State = CharacterState.ready\n            LogInfo(\"[FATE] State Change: Ready\")\n        end\n        return\n    elseif GetCharacterCondition(CharacterCondition.mounted) then\n        State = CharacterState.middleOfFateDismount\n        LogInfo(\"[FATE] State Change: MiddleOfFateDismount\")\n        return\n    elseif CurrentFate.isCollectionsFate then\n        yield(\"/wait 1\") -- needs a moment after start of fate for GetFateEventItem to populate\n        if GetItemCount(GetFateEventItem(CurrentFate.fateId)) >= 7 or (GotCollectionsFullCredit and GetFateProgress(CurrentFate.fateId) == 100) then\n            yield(\"/vnav stop\")\n            State = CharacterState.collectionsFateTurnIn\n            LogInfo(\"[FATE] State Change: CollectionsFatesTurnIn\")\n        end\n    end\n\n    LogInfo(\"DoFate->Finished transition checks\")\n\n    -- do not target fate npc during combat\n    if CurrentFate.npcName ~=nil and GetTargetName() == CurrentFate.npcName then\n        LogInfo(\"[FATE] Attempting to clear target.\")\n        ClearTarget()\n        yield(\"/wait 1\")\n    end\n\n    TurnOnCombatMods(\"auto\")\n\n    GemAnnouncementLock = false\n\n    -- switches to targeting forlorns for bonus (if present)\n    if not IgnoreForlorns then\n        yield(\"/target 迷失少女\")\n        if not IgnoreBigForlornOnly then\n            yield(\"/target 迷失者\")\n        end\n    end\n\n    if (GetTargetName() == \"迷失少女\" or GetTargetName() == \"迷失者\") then\n        if IgnoreForlorns or (IgnoreBigForlornOnly and GetTargetName() == \"迷失者\") then\n            ClearTarget()\n        elseif GetTargetHP() > 0 then\n            if not ForlornMarked then\n                yield(\"/marking attack1\")\n                if Echo == \"All\" or ChatCommandType == \"p\" then\n                    yield(\"/\"..ChatCommandType..\" 发现 迷失者! <se.3>\")\n                end\n                TurnOffAoes()\n                ForlornMarked = true\n            end\n        else\n            ClearTarget()\n            TurnOnAoes()\n        end\n    else\n        TurnOnAoes()\n    end\n\n    -- targets whatever is trying to kill you\n    if not HasTarget() then\n        yield(\"/battletarget\")\n    end\n\n    -- clears target\n    if GetTargetFateID() ~= CurrentFate.fateId and not IsTargetInCombat() then\n        ClearTarget()\n    end\n\n    -- do not interrupt casts to path towards enemies\n    if GetCharacterCondition(CharacterCondition.casting) then\n        return\n    end\n\n    -- pathfind closer if enemies are too far\n    if not GetCharacterCondition(CharacterCondition.inCombat) then\n        if HasTarget() then\n            local x,y,z = GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos()\n            if GetDistanceToTarget() <= (MaxDistance + GetTargetHitboxRadius()) then\n                if PathfindInProgress() or PathIsRunning() then\n                    yield(\"/vnav stop\")\n                    yield(\"/wait 3.002\") -- wait 5s before inching any closer // Maybe it won't take that long\n                elseif (GetDistanceToTarget() > (1 + GetTargetHitboxRadius())) and not GetCharacterCondition(CharacterCondition.casting) then -- never move into hitbox\n                    PathfindAndMoveTo(x, y, z)\n                    yield(\"/wait 1\") -- inch closer by 1s\n                end\n            elseif not (PathfindInProgress() or PathIsRunning()) then\n                yield(\"/wait 3.003\") -- give 5s for enemy AoE casts to go off before attempting to move closer // Maybe it won't take that long\n                if (x ~= 0 and z~=0 and not GetCharacterCondition(CharacterCondition.inCombat)) and not GetCharacterCondition(CharacterCondition.casting) then\n                    PathfindAndMoveTo(x, y, z)\n                end\n            end\n            return\n        else\n            TargetClosestFateEnemy()\n            yield(\"/wait 1\") -- wait in case target doesn't stick\n            if (not HasTarget()) and not GetCharacterCondition(CharacterCondition.casting) then\n                PathfindAndMoveTo(CurrentFate.x, CurrentFate.y, CurrentFate.z)\n            end\n        end\n    else\n        if HasTarget() and (GetDistanceToTarget() <= (MaxDistance + GetTargetHitboxRadius())) then\n            if PathfindInProgress() or PathIsRunning() then\n                yield(\"/vnav stop\")\n            end\n        elseif not CurrentFate.isBossFate then\n            if not (PathfindInProgress() or PathIsRunning()) then\n                yield(\"/wait 3.004\")\n                local x,y,z = GetTargetRawXPos(), GetTargetRawYPos(), GetTargetRawZPos()\n                if (x ~= 0 and z~=0)  and not GetCharacterCondition(CharacterCondition.casting) then\n                    PathfindAndMoveTo(x,y,z, GetCharacterCondition(CharacterCondition.flying) and SelectedZone.flying)\n                end\n            end\n        end\n    end\n\n    --hold buff thingy\n    if GetFateProgress(CurrentFate.fateId) >= PercentageToHoldBuff then\n        TurnOffRaidBuffs()\n    end\nend\n\n--#endregion\n\n--#region State Transition Functions\n\nfunction FoodCheck()\n    --food usage\n    if not HasStatusId(48) and Food ~= \"\" then\n        yield(\"/item \" .. Food)\n    end\nend\n\nfunction PotionCheck()\n    --pot usage\n    if not HasStatusId(49) and Potion ~= \"\" then\n        yield(\"/item \" .. Potion)\n    end\nend\n\nfunction Ready()\n    FoodCheck()\n    PotionCheck()\n\n    CombatModsOn = false -- expect RSR to turn off after every fate\n    GotCollectionsFullCredit = false\n    ForlornMarked = false\n    MovingAnnouncementLock = false\n\n    local shouldWaitForBonusBuff = WaitIfBonusBuff and (HasStatusId(1288) or HasStatusId(1289))\n\n    NextFate = SelectNextFate()\n    if CurrentFate ~= nil and not IsFateActive(CurrentFate.fateId) then\n        CurrentFate = nil\n    end\n\n    if CurrentFate == nil then\n        LogInfo(\"[FATE] CurrentFate is nil\")\n    else\n        LogInfo(\"[FATE] CurrentFate is \"..CurrentFate.fateName)\n    end\n\n    if NextFate == nil then\n        LogInfo(\"[FATE] NextFate is nil\")\n    else\n        LogInfo(\"[FATE] NextFate is \"..NextFate.fateName)\n    end\n\n    if not LogInfo(\"[FATE] Ready -> IsPlayerAvailable()\") and not IsPlayerAvailable() then\n        return\n    elseif not LogInfo(\"[FATE] Ready -> Repair\") and RepairAmount > 0 and NeedsRepair(RepairAmount) and\n        (not shouldWaitForBonusBuff or (SelfRepair and GetItemCount(33916) > 0)) then\n        State = CharacterState.repair\n        LogInfo(\"[FATE] State Change: Repair\")\n    elseif not LogInfo(\"[FATE] Ready -> ExtractMateria\") and ShouldExtractMateria and CanExtractMateria(100) and GetInventoryFreeSlotCount() > 1 then\n        State = CharacterState.extractMateria\n        LogInfo(\"[FATE] State Change: ExtractMateria\")\n    elseif (not LogInfo(\"[FATE] Ready -> WaitBonusBuff\") and NextFate == nil and shouldWaitForBonusBuff) and DownTimeWaitAtNearestAetheryte then\n        if not HasTarget() or GetTargetName() ~= \"以太之光\" or GetDistanceToTarget() > 20 then\n            State = CharacterState.flyBackToAetheryte\n            LogInfo(\"[FATE] State Change: FlyBackToAetheryte\")\n        else\n            yield(\"/wait 3\")\n        end\n        return\n    elseif not LogInfo(\"[FATE] Ready -> ExchangingVouchers\") and WaitingForFateRewards == 0 and\n        ShouldExchangeBicolorGemstones and (BicolorGemCount >= 1400) and not shouldWaitForBonusBuff\n    then\n        State = CharacterState.exchangingVouchers\n        LogInfo(\"[FATE] State Change: ExchangingVouchers\")\n    elseif not LogInfo(\"[FATE] Ready -> ProcessRetainers\") and WaitingForFateRewards == 0 and\n        Retainers and ARRetainersWaitingToBeProcessed() and GetInventoryFreeSlotCount() > 1  and not shouldWaitForBonusBuff\n    then\n        State = CharacterState.processRetainers\n        LogInfo(\"[FATE] State Change: ProcessingRetainers\")\n    elseif not LogInfo(\"[FATE] Ready -> GC TurnIn\") and ShouldGrandCompanyTurnIn and\n        GetInventoryFreeSlotCount() < InventorySlotsLeft and not shouldWaitForBonusBuff\n    then\n        State = CharacterState.gcTurnIn\n        LogInfo(\"[FATE] State Change: GCTurnIn\")\n    elseif not LogInfo(\"[FATE] Ready -> TeleportBackToFarmingZone\") and not IsInZone(SelectedZone.zoneId) then\n        TeleportTo(SelectedZone.aetheryteList[1].aetheryteName)\n        return\n    elseif not LogInfo(\"[FATE] Ready -> SummonChocobo\") and ShouldSummonChocobo and GetBuddyTimeRemaining() <= ResummonChocoboTimeLeft and\n        (not shouldWaitForBonusBuff or GetItemCount(4868) > 0) then\n        State = CharacterState.summonChocobo\n    elseif not LogInfo(\"[FATE] Ready -> NextFate nil\") and NextFate == nil then\n        if EnableChangeInstance and GetZoneInstance() > 0 and not shouldWaitForBonusBuff then\n            State = CharacterState.changingInstances\n            LogInfo(\"[FATE] State Change: ChangingInstances\")\n            return\n        elseif CompanionScriptMode and not shouldWaitForBonusBuff then\n            if WaitingForFateRewards == 0 then\n                StopScript = true\n                LogInfo(\"[FATE] StopScript: Ready\")\n            else\n                LogInfo(\"[FATE] Waiting for fate rewards\")\n            end\n        elseif (not HasTarget() or GetTargetName() ~= \"以太之光\" or GetDistanceToTarget() > 20) and DownTimeWaitAtNearestAetheryte then\n            State = CharacterState.flyBackToAetheryte\n            LogInfo(\"[FATE] State Change: FlyBackToAetheryte\")\n        else\n            yield(\"/wait 10\")\n        end\n        return\n    elseif CompanionScriptMode and DidFate and not shouldWaitForBonusBuff then\n        if WaitingForFateRewards == 0 then\n            StopScript = true\n            LogInfo(\"[FATE] StopScript: DidFate\")\n        else\n            LogInfo(\"[FATE] Waiting for fate rewards\")\n        end\n    elseif not LogInfo(\"[FATE] Ready -> MovingToFate\") then -- and ((CurrentFate == nil) or (GetFateProgress(CurrentFate.fateId) == 100) and NextFate ~= nil) then\n        CurrentFate = NextFate\n        SetMapFlag(SelectedZone.zoneId, CurrentFate.x, CurrentFate.y, CurrentFate.z)\n        yield(\"/\"..ChatCommandType..\" <flag>2\")\n        State = CharacterState.moveToFate\n        LogInfo(\"[FATE] State Change: MovingtoFate \"..CurrentFate.fateName)\n    end\n\n    if not GemAnnouncementLock and (Echo == \"All\" or Echo == \"Gems\") then\n        GemAnnouncementLock = true\n        if BicolorGemCount >= 1400 then\n            yield(\"/echo [FATE] 你已经有 \"..tostring(BicolorGemCount)..\"/1500 双色宝石！ <se.3>\")\n        else\n            yield(\"/echo [FATE] 双色宝石: \"..tostring(BicolorGemCount)..\"/1500\")\n        end\n    end\nend\n\n\nfunction HandleDeath()\n    CurrentFate = nil\n\n    if CombatModsOn then\n        TurnOffCombatMods()\n    end\n\n    if PathfindInProgress() or PathIsRunning() then\n        yield(\"/vnav stop\")\n    end\n\n    if GetCharacterCondition(CharacterCondition.dead) then --Condition Dead\n        if Echo and not DeathAnnouncementLock then\n            DeathAnnouncementLock = true\n            if Echo == \"All\" then\n                yield(\"/echo [FATE] 您陷入了无法战斗的状态，返回到登记的以太之光。\")\n            end\n        end\n\n        if IsAddonVisible(\"SelectYesno\") then --rez addon yes\n            yield(\"/callback SelectYesno true 0\")\n            yield(\"/wait 0.1\")\n        end\n    else\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        DeathAnnouncementLock = false\n    end\nend\n\nfunction ExecuteBicolorExchange()\n    CurrentFate = nil\n\n    if BicolorGemCount >= 1400 then\n        if IsAddonVisible(\"SelectYesno\") then\n            yield(\"/callback SelectYesno true 0\")\n            return\n        end\n\n        if IsAddonVisible(\"ShopExchangeCurrency\") then\n            yield(\"/callback ShopExchangeCurrency false 0 \"..SelectedBicolorExchangeData.item.itemIndex..\" \"..(BicolorGemCount//SelectedBicolorExchangeData.item.price))\n            return\n        end\n\n        if not IsInZone(SelectedBicolorExchangeData.zoneId) then\n            TeleportTo(SelectedBicolorExchangeData.aetheryteName)\n            return\n        end\n    \n        local shopX = SelectedBicolorExchangeData.x\n        local shopY = SelectedBicolorExchangeData.y\n        local shopZ = SelectedBicolorExchangeData.z\n    \n        if SelectedBicolorExchangeData.miniAethernet ~= nil and\n            GetDistanceToPoint(shopX, shopY, shopZ) > (DistanceBetween(SelectedBicolorExchangeData.miniAethernet.x, SelectedBicolorExchangeData.miniAethernet.y, SelectedBicolorExchangeData.miniAethernet.z, shopX, shopY, shopZ) + 10) then\n            LogInfo(\"Distance to shopkeep is too far. Using mini aetheryte.\")\n            yield(\"/li \"..SelectedBicolorExchangeData.miniAethernet.name)\n            --yield(\"/wait 1\") -- give it a moment to register\n            yield(\"/wait 5\") -- give it a moment to register 过短延迟会导致连续使用命令卡死\n            return\n        elseif IsAddonVisible(\"TelepotTown\") then\n            LogInfo(\"TelepotTown open\")\n            yield(\"/callback TelepotTown false -1\")\n        elseif GetDistanceToPoint(shopX, shopY, shopZ) > 5 then\n            LogInfo(\"Distance to shopkeep is too far. Walking there.\")\n            if not (PathfindInProgress() or PathIsRunning()) then\n                LogInfo(\"Path not running\")\n                PathfindAndMoveTo(shopX, shopY, shopZ)\n            end\n        else\n            LogInfo(\"[FATE] Arrived at Shopkeep\")\n            if PathfindInProgress() or PathIsRunning() then\n                yield(\"/vnav stop\")\n            end\n    \n            if not HasTarget() or GetTargetName() ~= SelectedBicolorExchangeData.shopKeepName then\n                yield(\"/target \"..SelectedBicolorExchangeData.shopKeepName)\n            elseif not GetCharacterCondition(CharacterCondition.occupiedInQuestEvent) then\n                yield(\"/interact\")\n            end\n        end\n    else\n        if IsAddonVisible(\"ShopExchangeCurrency\") then\n            LogInfo(\"[FATE] Attemping to close shop window\")\n            yield(\"/callback ShopExchangeCurrency true -1\")\n            return\n        elseif GetCharacterCondition(CharacterCondition.occupiedInEvent) then\n            LogInfo(\"[FATE] Character still occupied talking to shopkeeper\")\n            yield(\"/wait 0.5\")\n            return\n        end\n\n        State = CharacterState.ready\n        LogInfo(\"[FATE] State Change: Ready\")\n        return\n    end\nend\n\nfunction ProcessRetainers()\n    CurrentFate = nil\n\n    LogInfo(\"[FATE] Handling retainers...\")\n    if ARRetainersWaitingToBeProcessed() and GetInventoryFreeSlotCount() > 1 then\n    \n        if PathfindInProgress() or PathIsRunning() then\n            return\n        end\n\n        if not IsInZone(129) then\n            yield(\"/vnav stop\")\n            TeleportTo(\"利姆萨·罗敏萨下层甲板\")\n            return\n        end\n\n        local summoningBell = {\n            x = -122.72,\n            y = 18.00,\n            z = 20.39\n        }\n        if GetDistanceToPoint(summoningBell.x, summoningBell.y, summoningBell.z) > 4.5 then\n            PathfindAndMoveTo(summoningBell.x, summoningBell.y, summoningBell.z)\n            return\n        end\n\n        if not HasTarget() or GetTargetName() ~= \"传唤铃\" then\n            yield(\"/target 传唤铃\")\n            return\n        end\n\n        if not GetCharacterCondition(CharacterCondition.occupiedSummoningBell) then\n            yield(\"/interact\")\n            if IsAddonVisible(\"RetainerList\") then\n                yield(\"/ays e\")\n                if Echo == \"All\" then\n                    yield(\"/echo [FATE] 正在处理雇员\")\n                end\n                yield(\"/wait 1\")\n            end\n        end\n    else\n        if IsAddonVisible(\"RetainerList\") then\n            yield(\"/callback RetainerList true -1\")\n        elseif not GetCharacterCondition(CharacterCondition.occupiedSummoningBell) then\n            State = CharacterState.ready\n            LogInfo(\"[FATE] State Change: Ready\")\n        end\n    end\nend\n\nfunction GrandCompanyTurnIn()\n    if GetInventoryFreeSlotCount() <= InventorySlotsLeft then\n        local playerGC = GetPlayerGC()\n        local gcZoneIds = {\n            129, --利姆萨·罗敏萨下层甲板\n            132, --格里达尼亚新街\n            130 --乌尔达哈现世回廊\n        }\n        if not IsInZone(gcZoneIds[playerGC]) then\n            yield(\"/li gc\")\n            --yield(\"/wait 1\")\n            yield(\"/wait 5\") -- 过短延迟会导致连续使用命令卡死\n        elseif DeliverooIsTurnInRunning() then\n            return\n        else\n            yield(\"/deliveroo enable\")\n        end\n    else\n        State = CharacterState.ready\n        LogInfo(\"State Change: Ready\")\n    end\nend\n\nfunction Repair()\n    if IsAddonVisible(\"SelectYesno\") then\n        yield(\"/callback SelectYesno true 0\")\n        return\n    end\n\n    if IsAddonVisible(\"Repair\") then\n        if not NeedsRepair(RepairAmount) then\n            yield(\"/callback Repair true -1\") -- if you don't need repair anymore, close the menu\n        else\n            yield(\"/callback Repair true 0\") -- select repair\n        end\n        return\n    end\n\n    -- if occupied by repair, then just wait\n    if GetCharacterCondition(CharacterCondition.occupiedMateriaExtractionAndRepair) then\n        LogInfo(\"[FATE] Repairing...\")\n        yield(\"/wait 1\")\n        return\n    end\n\n    local hawkersAlleyAethernetShard = { x=-213.95, y=15.99, z=49.35 }\n    if SelfRepair then\n        if GetItemCount(33916) > 0 then\n            if IsAddonVisible(\"Shop\") then\n                yield(\"/callback Shop true -1\")\n                return\n            end\n\n            if not IsInZone(SelectedZone.zoneId) then\n                TeleportTo(SelectedZone.aetheryteList[1].aetheryteName)\n                return\n            end\n\n            if GetCharacterCondition(CharacterCondition.mounted) then\n                Dismount()\n                LogInfo(\"[FATE] State Change: Dismounting\")\n                return\n            end\n\n            if NeedsRepair(RepairAmount) then\n                if not IsAddonVisible(\"Repair\") then\n                    LogInfo(\"[FATE] Opening repair menu...\")\n                    yield(\"/gaction 修理\")\n                end\n            else\n                State = CharacterState.ready\n                LogInfo(\"[FATE] State Change: Ready\")\n            end\n        elseif ShouldAutoBuyDarkMatter then\n            if not IsInZone(129) then\n                if Echo == \"All\" then\n                    yield(\"/echo 没有暗物质了！去下层甲板买点吧\")\n                end\n                TeleportTo(\"利姆萨·罗敏萨下层甲板\")\n                return\n            end\n\n            local darkMatterVendor = { npcName=\"乌恩辛雷尔\", x=-257.71, y=16.19, z=50.11, wait=0.08 }\n            if GetDistanceToPoint(darkMatterVendor.x, darkMatterVendor.y, darkMatterVendor.z) > (DistanceBetween(hawkersAlleyAethernetShard.x, hawkersAlleyAethernetShard.y, hawkersAlleyAethernetShard.z,darkMatterVendor.x, darkMatterVendor.y, darkMatterVendor.z) + 10) then\n                yield(\"/li 市场（国际广场）\")\n                yield(\"/wait 1\") -- give it a moment to register\n            elseif IsAddonVisible(\"TelepotTown\") then\n                yield(\"/callback TelepotTown false -1\")\n            elseif GetDistanceToPoint(darkMatterVendor.x, darkMatterVendor.y, darkMatterVendor.z) > 5 then\n                if not (PathfindInProgress() or PathIsRunning()) then\n                    PathfindAndMoveTo(darkMatterVendor.x, darkMatterVendor.y, darkMatterVendor.z)\n                end\n            else\n                if not HasTarget() or GetTargetName() ~= darkMatterVendor.npcName then\n                    yield(\"/target \"..darkMatterVendor.npcName)\n                elseif not GetCharacterCondition(CharacterCondition.occupiedInQuestEvent) then\n                    yield(\"/interact\")\n                elseif IsAddonVisible(\"SelectYesno\") then\n                    yield(\"/callback SelectYesno true 0\")\n                elseif IsAddonVisible(\"Shop\") then\n                    yield(\"/callback Shop true 0 40 99\")\n                end\n            end\n        else\n            if Echo == \"All\" then\n                yield(\"/echo 暗物质已耗尽且自动购买功能已关闭，正在前往利姆萨·罗敏萨修理工。\")\n            end\n            SelfRepair = false\n        end\n    else\n        if NeedsRepair(RepairAmount) then\n            if not IsInZone(129) then\n                TeleportTo(\"利姆萨·罗敏萨下层甲板\")\n                return\n            end\n            \n            local mender = { npcName=\"阿里斯特尔\", x=-246.87, y=16.19, z=49.83 }\n            if GetDistanceToPoint(mender.x, mender.y, mender.z) > (DistanceBetween(hawkersAlleyAethernetShard.x, hawkersAlleyAethernetShard.y, hawkersAlleyAethernetShard.z, mender.x, mender.y, mender.z) + 10) then\n                yield(\"/li 市场（国际广场）\")\n                yield(\"/wait 1\") -- give it a moment to register\n            elseif IsAddonVisible(\"TelepotTown\") then\n                yield(\"/callback TelepotTown false -1\")\n            elseif GetDistanceToPoint(mender.x, mender.y, mender.z) > 5 then\n                if not (PathfindInProgress() or PathIsRunning()) then\n                    PathfindAndMoveTo(mender.x, mender.y, mender.z)\n                end\n            else\n                if not HasTarget() or GetTargetName() ~= mender.npcName then\n                    yield(\"/target \"..mender.npcName)\n                elseif not GetCharacterCondition(CharacterCondition.occupiedInQuestEvent) then\n                    yield(\"/interact\")\n                end\n            end\n        else\n            State = CharacterState.ready\n            LogInfo(\"[FATE] State Change: Ready\")\n        end\n    end\nend\n\nfunction ExtractMateria()\n    if GetCharacterCondition(CharacterCondition.mounted) then\n        Dismount()\n        LogInfo(\"[FATE] State Change: Dismounting\")\n        return\n    end\n\n    if GetCharacterCondition(CharacterCondition.occupiedMateriaExtractionAndRepair) then\n        return\n    end\n\n    if CanExtractMateria(100) and GetInventoryFreeSlotCount() > 1 then\n        if not IsAddonVisible(\"Materialize\") then\n            yield(\"/gaction 精制魔晶石\")\n            return\n        end\n\n        LogInfo(\"[FATE] Extracting materia...\")\n            \n        if IsAddonVisible(\"MaterializeDialog\") then\n            yield(\"/callback MaterializeDialog true 0\")\n        else\n            yield(\"/callback Materialize true 2 0\")\n        end\n    else\n        if IsAddonVisible(\"Materialize\") then\n            yield(\"/callback Materialize true -1\")\n        else\n            State = CharacterState.ready\n            LogInfo(\"[FATE] State Change: Ready\")\n        end\n    end\nend\n\nCharacterState = {\n    ready = Ready,\n    dead = HandleDeath,\n    unexpectedCombat = HandleUnexpectedCombat,\n    mounting = Mount,\n    npcDismount = NPCDismount,\n    middleOfFateDismount = MiddleOfFateDismount,\n    moveToFate = MoveToFate,\n    interactWithNpc = InteractWithFateNpc,\n    collectionsFateTurnIn = CollectionsFateTurnIn,\n    doFate = DoFate,\n    waitForContinuation = WaitForContinuation,\n    changingInstances = ChangeInstance,\n    changeInstanceDismount = ChangeInstanceDismount,\n    flyBackToAetheryte = FlyBackToAetheryte,\n    extractMateria = ExtractMateria,\n    repair = Repair,\n    exchangingVouchers = ExecuteBicolorExchange,\n    processRetainers = ProcessRetainers,\n    gcTurnIn = GrandCompanyTurnIn,\n    summonChocobo = SummonChocobo,\n    autoBuyGysahlGreens = AutoBuyGysahlGreens\n}\n\n--#endregion State Transition Functions\n\n--#region Main\n\nLogInfo(\"[FATE] Starting fate farming script.\")\n\nStopScript = false\nDidFate = false\nGemAnnouncementLock = false\nDeathAnnouncementLock = false\nMovingAnnouncementLock = false\nSuccessiveInstanceChanges = 0\nLastInstanceChangeTimestamp = 0\nLastTeleportTimeStamp = 0\nGotCollectionsFullCredit = false -- needs 7 items for  full\n-- variable to track collections fates that you have completed but are still active.\n-- will not leave area or change instance if value ~= 0\nWaitingForFateRewards = 0\nLastFateEndTime = os.clock()\nLastStuckCheckTime = os.clock()\nLastStuckCheckPosition = {x=GetPlayerRawXPos(), y=GetPlayerRawYPos(), z=GetPlayerRawZPos()}\nMainClass = GetClassJobTableFromId(GetClassJobId())\nBossFatesClass = nil\nif ClassForBossFates ~= \"\" then\n    BossFatesClass = GetClassJobTableFromAbbrev(ClassForBossFates)\nend\nSetMaxDistance()\n\nSelectedZone = SelectNextZone()\nif SelectedZone.zoneName ~= \"\" and Echo == \"All\" then\n    yield(\"/echo [FATE] 启用地图 \"..SelectedZone.zoneName)\nend\nLogInfo(\"[FATE] Farming Start for \"..SelectedZone.zoneName)\n\nfor _, shop in ipairs(BicolorExchangeData) do\n    for _, item in ipairs(shop.shopItems) do\n        if item.itemName == ItemToPurchase then\n            SelectedBicolorExchangeData = {\n                shopKeepName = shop.shopKeepName,\n                zoneId = shop.zoneId,\n                aetheryteName = shop.aetheryteName,\n                miniAethernet = shop.miniAethernet,\n                x = shop.x, y = shop.y, z = shop.z,\n                item = item\n            }\n        end\n    end\nend\nif SelectedBicolorExchangeData == nil then\n    yield(\"/echo [FATE]无法识别双色商店商品”..ItemToPurchase..“！请确保它在BicolorExchangeData表中！\")\n    StopScript = true\nend\n\nState = CharacterState.ready\nCurrentFate = nil\nif IsInFate() and GetFateProgress(GetNearestFate()) < 100 then\n    CurrentFate = BuildFateTable(GetNearestFate())\nend\n\nif ShouldSummonChocobo and GetBuddyTimeRemaining() > 0 then\n    yield(\"/cac \"..ChocoboStance)\nend\n\nwhile not StopScript do\n    if not NavIsReady() then\n        yield(\"/echo [FATE] 等待 vnavmesh 构建...\")\n        LogInfo(\"[FATE] Waiting for vnavmesh to build...\")\n        repeat\n            yield(\"/wait 1\")\n        until NavIsReady()\n    end\n    if State ~= CharacterState.dead and GetCharacterCondition(CharacterCondition.dead) then\n        State = CharacterState.dead\n        LogInfo(\"[FATE] State Change: Dead\")\n    elseif State ~= CharacterState.unexpectedCombat and State ~= CharacterState.doFate and\n        State ~= CharacterState.waitForContinuation and State ~= CharacterState.collectionsFateTurnIn and\n        (not IsInFate() or (IsInFate() and IsCollectionsFate(GetFateName(GetNearestFate())) and GetFateProgress(GetNearestFate()) == 100)) and\n        GetCharacterCondition(CharacterCondition.inCombat)\n    then\n        State = CharacterState.unexpectedCombat\n        LogInfo(\"[FATE] State Change: UnexpectedCombat\")\n    end\n    \n    BicolorGemCount = GetItemCount(26807)\n\n    if not (IsPlayerCasting() or\n        GetCharacterCondition(CharacterCondition.betweenAreas) or\n        GetCharacterCondition(CharacterCondition.jumping48) or\n        GetCharacterCondition(CharacterCondition.jumping61) or\n        GetCharacterCondition(CharacterCondition.mounting57) or\n        GetCharacterCondition(CharacterCondition.mounting64) or\n        GetCharacterCondition(CharacterCondition.beingMoved) or\n        GetCharacterCondition(CharacterCondition.occupiedMateriaExtractionAndRepair) or\n        LifestreamIsBusy())\n    then\n        if WaitingForFateRewards ~= 0 and not IsFateActive(WaitingForFateRewards) then\n            WaitingForFateRewards = 0\n            LogInfo(\"[FATE] WaitingForFateRewards: \"..tostring(WaitingForFateRewards))\n        end\n        State()\n    end\n    yield(\"/wait 0.3\")\nend\nyield(\"/vnav stop\")\n\nif GetClassJobId() ~= MainClass.classId then\n    yield(\"/gs change \"..MainClass.className)\nend\n--#endregion Main",
        "CraftingLoop": false,
        "IsPostProcess": false,
        "CraftLoopCount": 0,
        "Language": 2
      }
    ]
  },
  "CraftSkip": true,
  "SmartWait": true,
  "QualitySkip": true,
  "LoopTotal": false,
  "LoopEcho": false,
  "DisableMonospaced": false,
  "UseCraftLoopTemplate": false,
  "CraftLoopTemplate": "/craft {{count}}\n/waitaddon \"RecipeNote\" <maxwait.5>/click \"synthesize\"/waitaddon \"Synthesis\" <maxwait.5>{{macro}}/loop",
  "CraftLoopFromRecipeNote": true,
  "CraftLoopMaxWait": 5,
  "CraftLoopEcho": false,
  "MaxTimeoutRetries": 0,
  "NoisyErrors": false,
  "BeepFrequency": 900,
  "BeepDuration": 250,
  "BeepCount": 3,
  "UseSNDTargeting": true,
  "ARCharacterPostProcessMacro": null,
  "ARCharacterPostProcessExcludedCharacters": [],
  "StopMacroIfActionTimeout": true,
  "StopMacroIfItemNotFound": false,
  "StopMacroIfCantUseItem": false,
  "StopMacroIfTargetNotFound": false,
  "StopMacroIfAddonNotFound": false,
  "StopMacroIfAddonNotVisible": false,
  "ChatType": 57,
  "ErrorChatType": 2,
  "LuaRequirePaths": [],
  "UseMacroFileSystem": false
}